{"version":3,"file":"usePortal.js","sources":["../../src/hooks/usePortal.ts"],"sourcesContent":["import { useRef, useEffect } from \"react\";\n\n/**\n * Creates DOM element to be used as React root.\n * @returns {HTMLElement}\n */\nfunction createRootElement(id: string): HTMLElement {\n  const rootContainer = document.createElement(\"div\");\n  rootContainer.setAttribute(\"id\", id);\n  return rootContainer;\n}\n\n/**\n * Appends element as last child of body.\n * @param {HTMLElement} rootElem\n */\nfunction addRootElement(rootElem: HTMLElement) {\n  document.body.insertBefore<HTMLElement>(\n    rootElem,\n    document.body.lastElementChild.nextElementSibling\n  );\n}\n\n/**\n * Hook to create a React Portal.\n * Automatically handles creating and tearing-down the root elements (no SRR\n * makes this trivial), so there is no need to ensure the parent target already\n * exists.\n * @example\n * const target = usePortal(id, [id]);\n * return createPortal(children, target);\n * @param {String} id The id of the target container, e.g 'modal' or 'spotlight'\n * @returns {HTMLElement} The DOM node to use as the Portal target.\n */\nexport function usePortal(id: string): HTMLElement {\n  const rootElemRef = useRef(null);\n\n  useEffect(function setupElement() {\n    // Look for existing target dom element to append to\n    const existingParent = document.querySelector(`#${id}`);\n    // Parent is either a new root or the existing dom element\n    const parentElem = (existingParent as HTMLElement) || createRootElement(id);\n\n    // If there is no existing DOM element, add a new one.\n    if (!existingParent) {\n      addRootElement(parentElem);\n    }\n\n    // Add the detached element to the parent\n    parentElem.appendChild(rootElemRef.current);\n\n    return function removeElement() {\n      rootElemRef.current.remove();\n      if (parentElem.childNodes.length === -1) {\n        parentElem.remove();\n      }\n    };\n  }, []);\n\n  /**\n   * It's important we evaluate this lazily:\n   * - We need first render to contain the DOM element, so it shouldn't happen\n   *   in useEffect. We would normally put this in the constructor().\n   * - We can't do 'const rootElemRef = useRef(document.createElement('div))',\n   *   since this will run every single render (that's a lot).\n   * - We want the ref to consistently point to the same DOM element and only\n   *   ever run once.\n   * @link https://reactjs.org/docs/hooks-faq.html#how-to-create-expensive-objects-lazily\n   */\n  function getRootElem() {\n    if (!rootElemRef.current) {\n      rootElemRef.current = document.createElement(\"div\");\n    }\n    return rootElemRef.current;\n  }\n\n  return getRootElem();\n}\n"],"names":["createRootElement","id","rootContainer","document","createElement","setAttribute","addRootElement","rootElem","body","insertBefore","lastElementChild","nextElementSibling","usePortal","getRootElem","rootElemRef","current","useRef","useEffect","setupElement","existingParent","querySelector","parentElem","appendChild","removeElement","remove","childNodes","length"],"mappings":";;AAEA;;;AAGG,IACH,SAASA,iBAAiB,CAACC,EAAU,EAAe;IAClD,IAAMC,aAAa,GAAGC,QAAQ,CAACC,aAAa,CAAC,KAAK,CAAC,CAAC;AACpDF,IAAAA,aAAa,CAACG,YAAY,CAAC,IAAI,EAAEJ,EAAE,CAAC,CAAC;AACrC,IAAA,OAAOC,aAAa,CAAC;AACtB,CAAA;AAED;;;AAGG,IACH,SAASI,cAAc,CAACC,QAAqB,EAAE;AAC7CJ,IAAAA,QAAQ,CAACK,IAAI,CAACC,YAAY,CACxBF,QAAQ,EACRJ,QAAQ,CAACK,IAAI,CAACE,gBAAgB,CAACC,kBAAkB,CAClD,CAAC;AACH,CAAA;AAED;;;;;;;;;;AAUG,IACI,SAASC,SAAS,CAACX,EAAU,EAAe;AAmCxCY,IAAAA,IAAAA,WAAW;;;;;;;;;MAApB,SAASA,WAAW,GAAG;AACrB,QAAA,IAAI,CAACC,WAAW,CAACC,OAAO,EAAE;YACxBD,WAAW,CAACC,OAAO,GAAGZ,QAAQ,CAACC,aAAa,CAAC,KAAK,CAAC,CAAC;AACrD,SAAA;QACD,OAAOU,WAAW,CAACC,OAAO,CAAC;AAC5B,KAAA,CAAA;AAvCD,IAAA,IAAMD,WAAW,GAAGE,MAAM,CAAC,IAAI,CAAC,CAAC;IAEjCC,SAAS,CAAC,SAASC,YAAY,GAAG;;AAEhC,QAAA,IAAMC,cAAc,GAAGhB,QAAQ,CAACiB,aAAa,CAAE,GAAC,CAAK,MAAA,CAAHnB,EAAE,CAAE,CAAC,CAAC;;QAExD,IAAMoB,UAAU,GAAG,cAAe,IAAoBrB,iBAAiB,CAACC,EAAE,CAAC,CAAC;;QAG5E,IAAI,CAACkB,cAAc,EAAE;YACnBb,cAAc,CAACe,UAAU,CAAC,CAAC;AAC5B,SAAA;;AAGDA,QAAAA,UAAU,CAACC,WAAW,CAACR,WAAW,CAACC,OAAO,CAAC,CAAC;QAE5C,OAAO,SAASQ,aAAa,GAAG;AAC9BT,YAAAA,WAAW,CAACC,OAAO,CAACS,MAAM,EAAE,CAAC;YAC7B,IAAIH,UAAU,CAACI,UAAU,CAACC,MAAM,KAAK,CAAC,CAAC,EAAE;gBACvCL,UAAU,CAACG,MAAM,EAAE,CAAC;AACrB,aAAA;SACF,CAAC;KACH,EAAE,EAAE,CAAC,CAAC;IAmBP,OAAOX,WAAW,EAAE,CAAC;AACtB;;;;"}