{"version":3,"file":"index.js","sources":["../../src/InputChips/InputChips.tsx"],"sourcesContent":["import React, { HTMLProps, ReactNode, useEffect, useState } from \"react\";\nimport useEvent from \"react-use-event-hook\";\n\nimport { ConditionalWrapper } from \"src/Conditional\";\nimport { InputHelpBaloon, InputHelpBlock } from \"src/InputHelp\";\nimport { Label, LabelColor } from \"src/Label\";\nimport { appendClass as ac } from \"src/utils\";\n\nimport \"../../css/chips.css\";\n\nexport type InputChipsProps = {\n  label?: ReactNode;\n  chipsColor?: LabelColor;\n  addOnBlur?: boolean;\n  allowRepeat?: boolean;\n  allowRegex?: string;\n  delimiters?: string | number[];\n  valueValidator?: (value: any) => boolean;\n  maxChips?: number;\n  baloon?: string;\n  className?: string;\n  id?: string;\n  error?: ReactNode;\n  value?: string[];\n  outerWrap?: boolean;\n  onChange?: (newValue: string[]) => void;\n  onChipRemove?: (idx: number) => void;\n  chipsOutside?: boolean;\n  noInput?: boolean;\n  renderChip?: (params: {\n    onDelete: () => unknown;\n    value: string;\n    idx: number;\n  }) => JSX.Element;\n};\n\nexport type FullInputChipsProps = InputChipsProps &\n  Omit<HTMLProps<HTMLInputElement>, \"id\" | \"value\" | \"onChange\" | \"label\">;\n\nconst emptyList: string[] = [];\n\nexport const InputChips = React.forwardRef<HTMLDivElement, FullInputChipsProps>(\n  (\n    {\n      chipsColor = \"light\",\n      addOnBlur = true,\n      delimiters = [13],\n      label = null,\n      allowRepeat = false,\n      allowRegex = null,\n      valueValidator = null,\n      maxChips = null,\n      baloon = null,\n      className = null,\n      id = null,\n      error = null,\n      value: initialValue = null,\n      onChange,\n      outerWrap = true,\n      chipsOutside = false,\n      renderChip = null,\n      onBlur = null,\n      onChipRemove = null,\n      onClick,\n      noInput,\n      ...input\n    },\n    ref\n  ) => {\n    const [value, setValue] = useState<string[]>(emptyList);\n\n    useEffect(() => {\n      setValue((curr) => initialValue || curr || emptyList);\n    }, [initialValue]);\n\n    const addValue = useEvent((v) => {\n      if (typeof valueValidator === \"function\") {\n        if (!valueValidator(v)) return;\n      }\n      setValue((curr) => {\n        if (allowRepeat || !(curr || []).includes(v)) {\n          const n = (curr || []).concat(v);\n          if (typeof onChange === \"function\") onChange(n);\n          return n;\n        } else return curr;\n      });\n    });\n\n    const handleKeyDown = useEvent((event) => {\n      let d = delimiters;\n      if (typeof d === \"string\") {\n        const { map } = Array.prototype;\n        d = map.call(d, (ch) => ch.charCodeAt(0));\n      }\n\n      if (Array.isArray(d) && d.includes(event.keyCode)) {\n        addValue(event.target.value);\n        event.target.value = \"\";\n        event.stopPropagation();\n        event.preventDefault();\n      }\n    });\n\n    const handleBlur = useEvent((event) => {\n      if (addOnBlur && event.target?.value) {\n        const { value } = event.target;\n        if (allowRegex && RegExp(allowRegex).test(value)) {\n          addValue(value);\n        } else if (!allowRegex) {\n          addValue(value);\n        }\n      }\n      event.target.value = \"\";\n      if (typeof onBlur === \"function\") onBlur(event);\n    });\n\n    const handleDelete = useEvent((idx) => {\n      setValue((curr) => {\n        curr.splice(idx, 1);\n        if (typeof onChange === \"function\") onChange(curr.slice());\n        return curr.slice();\n      });\n      if (typeof onChipRemove === \"function\") onChipRemove(idx);\n    });\n\n    const showInput =\n      (!maxChips ||\n        (maxChips && Array.isArray(value) && value.length < maxChips)) &&\n      !noInput;\n\n    return (\n      <ConditionalWrapper\n        wrapper={\n          <div\n            className={`form-group${ac(className)}${ac(\n              error,\n              \"form-group--error\"\n            )}`}\n            ref={ref}\n          ></div>\n        }\n        condition={outerWrap}\n      >\n        <div\n          className={`form-group__text chips${ac(\n            !outerWrap && className,\n            className\n          )}`}\n        >\n          {label ? (\n            <label htmlFor={id || input.name}>\n              {label}\n              {baloon ? <InputHelpBaloon baloon={baloon} /> : null}\n            </label>\n          ) : null}\n          {chipsOutside && Array.isArray(value) && value.length ? (\n            <span className=\"chips-outer qtr-margin-bottom\">\n              <span className=\"chips-inner\">\n                {value.map((v, i) =>\n                  renderChip ? (\n                    renderChip({\n                      value: v,\n                      idx: i,\n                      onDelete: () => handleDelete(i),\n                    })\n                  ) : (\n                    <Label\n                      removable\n                      onRemove={() => handleDelete(i)}\n                      color={chipsColor}\n                      size=\"small\"\n                      key={`${v}-${i}`}\n                      className=\"no-margin-bottom\"\n                    >\n                      {v}\n                    </Label>\n                  )\n                )}\n              </span>\n            </span>\n          ) : null}\n          <div\n            className={`input ${ac(!showInput, \"dbl-padding-right\")}`}\n            onClick={onClick}\n          >\n            {!chipsOutside && Array.isArray(value) && value.length ? (\n              <span className=\"chips-outer\">\n                <span className=\"chips-inner\">\n                  {value.map((v, i) =>\n                    renderChip ? (\n                      renderChip({\n                        value: v,\n                        idx: i,\n                        onDelete: () => handleDelete(i),\n                      })\n                    ) : (\n                      <Label\n                        removable\n                        onRemove={(e: MouseEvent) => {\n                          e.stopPropagation();\n                          e.preventDefault();\n                          handleDelete(i);\n                        }}\n                        color={chipsColor}\n                        size=\"small\"\n                        key={`${v}-${i}`}\n                        className=\"no-margin-bottom\"\n                      >\n                        {v}\n                      </Label>\n                    )\n                  )}\n                </span>\n              </span>\n            ) : null}\n            {showInput ? (\n              <input\n                type=\"text\"\n                onKeyDown={handleKeyDown}\n                onBlur={handleBlur}\n                id={id || input.name}\n                {...input}\n              />\n            ) : null}\n          </div>\n        </div>\n        {error ? <InputHelpBlock text={error} /> : null}\n      </ConditionalWrapper>\n    );\n  }\n);\n"],"names":["emptyList","InputChips","React","chipsColor","addOnBlur","delimiters","label","allowRepeat","allowRegex","valueValidator","maxChips","baloon","className","id","error","initialValue","onChange","outerWrap","chipsOutside","renderChip","onBlur","onChipRemove","onClick","noInput","input","ref","value","setValue","useState","useEffect","curr","addValue","useEvent","v","n","handleKeyDown","event","d","map","ch","handleBlur","_a","handleDelete","idx","showInput","ConditionalWrapper","ac","InputHelpBaloon","i","Label","e","InputHelpBlock"],"mappings":"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"}