{"version":3,"file":"index.js","sources":["../../src/InputChips/InputChips.tsx"],"sourcesContent":["import React, { HTMLProps, ReactNode, useEffect, useState } from \"react\";\nimport useEvent from \"react-use-event-hook\";\n\nimport { ConditionalWrapper } from \"src/Conditional\";\nimport { InputHelpBaloon, InputHelpBlock } from \"src/InputHelp\";\nimport { Label, LabelColor } from \"src/Label\";\nimport { appendClass as ac } from \"src/utils\";\n\nimport \"../../css/chips.css\";\n\nexport type InputChipsProps = {\n  label?: ReactNode;\n  chipsColor?: LabelColor;\n  addOnBlur?: boolean;\n  allowRepeat?: boolean;\n  allowRegex?: string;\n  delimiters?: string | number[];\n  valueValidator?: (value: any) => boolean;\n  maxChips?: number;\n  baloon?: string;\n  className?: string;\n  id?: string;\n  error?: ReactNode;\n  value?: string[];\n  outerWrap?: boolean;\n  onChange?: (newValue: string[]) => void;\n  onChipRemove?: (idx: number) => void;\n  chipsOutside?: boolean;\n  noInput?: boolean;\n  renderChip?: (params: {\n    onDelete: () => unknown;\n    value: string;\n    idx: number;\n  }) => JSX.Element;\n};\n\nexport type FullInputChipsProps = InputChipsProps &\n  Omit<HTMLProps<HTMLInputElement>, \"id\" | \"value\" | \"onChange\" | \"label\">;\n\nconst emptyList: string[] = [];\n\nexport const InputChips = React.forwardRef<HTMLDivElement, FullInputChipsProps>(\n  (\n    {\n      chipsColor = \"light\",\n      addOnBlur = true,\n      delimiters = [13],\n      label = null,\n      allowRepeat = false,\n      allowRegex = null,\n      valueValidator = null,\n      maxChips = null,\n      baloon = null,\n      className = null,\n      id = null,\n      error = null,\n      value: initialValue = null,\n      onChange,\n      outerWrap = true,\n      chipsOutside = false,\n      renderChip = null,\n      onBlur = null,\n      onChipRemove = null,\n      onClick,\n      noInput,\n      ...input\n    },\n    ref\n  ) => {\n    const [value, setValue] = useState<string[]>(emptyList);\n\n    useEffect(() => {\n      setValue((curr) => initialValue || curr || emptyList);\n    }, [initialValue]);\n\n    const addValue = useEvent((v) => {\n      if (typeof valueValidator === \"function\") {\n        if (!valueValidator(v)) return;\n      }\n      setValue((curr) => {\n        if (allowRepeat || !(curr || []).includes(v)) {\n          const n = (curr || []).concat(v);\n          if (typeof onChange === \"function\") onChange(n);\n          return n;\n        } else return curr;\n      });\n    });\n\n    const handleKeyDown = useEvent((event) => {\n      let d = delimiters;\n      if (typeof d === \"string\") {\n        const { map } = Array.prototype;\n        d = map.call(d, (ch) => ch.charCodeAt(0));\n      }\n\n      if (Array.isArray(d) && d.includes(event.keyCode)) {\n        addValue(event.target.value);\n        event.target.value = \"\";\n        event.stopPropagation();\n        event.preventDefault();\n      }\n    });\n\n    const handleBlur = useEvent((event) => {\n      if (addOnBlur && event.target?.value) {\n        const { value } = event.target;\n        if (allowRegex && RegExp(allowRegex).test(value)) {\n          addValue(value);\n        } else if (!allowRegex) {\n          addValue(value);\n        }\n      }\n      event.target.value = \"\";\n      if (typeof onBlur === \"function\") onBlur(event);\n    });\n\n    const handleDelete = useEvent((idx) => {\n      setValue((curr) => {\n        curr.splice(idx, 1);\n        if (typeof onChange === \"function\") onChange(curr.slice());\n        return curr.slice();\n      });\n      if (typeof onChipRemove === \"function\") onChipRemove(idx);\n    });\n\n    const showInput =\n      (!maxChips ||\n        (maxChips && Array.isArray(value) && value.length < maxChips)) &&\n      !noInput;\n\n    return (\n      <ConditionalWrapper\n        wrapper={\n          <div\n            className={`form-group${ac(className)}${ac(\n              error,\n              \"form-group--error\"\n            )}`}\n            ref={ref}\n          ></div>\n        }\n        condition={outerWrap}\n      >\n        <div\n          className={`form-group__text chips${ac(\n            !outerWrap && className,\n            className\n          )}`}\n        >\n          {label ? (\n            <label htmlFor={id || input.name}>\n              {label}\n              {baloon ? <InputHelpBaloon baloon={baloon} /> : null}\n            </label>\n          ) : null}\n          {chipsOutside && Array.isArray(value) && value.length ? (\n            <span className=\"chips-outer qtr-margin-bottom\">\n              <span className=\"chips-inner\">\n                {value.map((v, i) =>\n                  renderChip ? (\n                    renderChip({\n                      value: v,\n                      idx: i,\n                      onDelete: () => handleDelete(i),\n                    })\n                  ) : (\n                    <Label\n                      removable\n                      onRemove={() => handleDelete(i)}\n                      color={chipsColor}\n                      size=\"small\"\n                      key={`${v}-${i}`}\n                      className=\"no-margin-bottom\"\n                    >\n                      {v}\n                    </Label>\n                  )\n                )}\n              </span>\n            </span>\n          ) : null}\n          <div\n            className={`input ${ac(!showInput, \"dbl-padding-right\")}`}\n            onClick={onClick}\n          >\n            {!chipsOutside && Array.isArray(value) && value.length ? (\n              <span className=\"chips-outer\">\n                <span className=\"chips-inner\">\n                  {value.map((v, i) =>\n                    renderChip ? (\n                      renderChip({\n                        value: v,\n                        idx: i,\n                        onDelete: () => handleDelete(i),\n                      })\n                    ) : (\n                      <Label\n                        removable\n                        onRemove={(e: MouseEvent) => {\n                          e.stopPropagation();\n                          e.preventDefault();\n                          handleDelete(i);\n                        }}\n                        color={chipsColor}\n                        size=\"small\"\n                        key={`${v}-${i}`}\n                        className=\"no-margin-bottom\"\n                      >\n                        {v}\n                      </Label>\n                    )\n                  )}\n                </span>\n              </span>\n            ) : null}\n            {showInput ? (\n              <input\n                type=\"text\"\n                onKeyDown={handleKeyDown}\n                onBlur={handleBlur}\n                id={id || input.name}\n                {...input}\n              />\n            ) : null}\n          </div>\n        </div>\n        {error ? <InputHelpBlock text={error} /> : null}\n      </ConditionalWrapper>\n    );\n  }\n);\n"],"names":["emptyList","InputChips","React","chipsColor","addOnBlur","delimiters","label","allowRepeat","allowRegex","valueValidator","maxChips","baloon","className","id","error","initialValue","onChange","outerWrap","chipsOutside","renderChip","onBlur","onChipRemove","onClick","noInput","input","ref","value","setValue","useState","useEffect","curr","addValue","useEvent","v","handleKeyDown","event","d","map","ch","handleBlur","_a","handleDelete","idx","showInput","jsxs","ConditionalWrapper","jsx","ac","InputHelpBaloon","i","Label","e","InputHelpBlock"],"mappings":"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"}