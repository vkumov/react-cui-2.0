import{jsx as l,jsxs as h,Fragment as $}from"react/jsx-runtime";import{appendClass as S}from"../utils/index.js";import p,{forwardRef as K,createElement as T,cloneElement as ie,createContext as ae,useContext as re,useRef as se,useCallback as q,useMemo as de}from"react";import{useFloatingNodeId as ce,useFloating as me,useFloatingTree as ue,useInteractions as pe,useClick as fe,useRole as he,useDismiss as Ce,FloatingNode as ye,FloatingOverlay as ge,FloatingFocusManager as be}from"@floating-ui/react";import E from"classnames";import{Transition as _e}from"react-transition-group";import P from"react-use-event-hook";import{DisplayIf as we,ConditionalWrapper as ve}from"../Conditional/index.js";import{FloatingTreeWrapper as j,useFloatingContext as ke,FloatingProvider as Me}from"../FloatingProvider/index.js";import{useCustomDismiss as Ne}from"../hooks/useCustomDismiss.js";import{nanoid as xe}from"nanoid";import{Button as _}from"../Button/index.js";import{eventManager as g}from"../utils/eventManager.js";import{Input as Te}from"../Input/index.js";const L=({className:o=null,children:t,...a})=>l("div",{className:`modal__header${S(o)}`,...a,children:t}),w=K(({className:o=null,children:t,...a},n)=>l("div",{className:`modal__footer${S(o)}`,...a,ref:n,children:t})),v=K(({className:o=null,children:t,...a},n)=>l("div",{className:`modal__body${S(o)}`,...a,ref:n,children:t}));var W={modal__dialog__appear:"Modal-module_modal__dialog__appear__y9Qy2"};const U=({isOpen:o=!1,confirmType:t="primary",autoClose:a=!0,confirmText:n="Confirm",confirmHandle:i,closeHandle:r,prompt:c,dontAskAgain:s={show:!1}})=>{const[m,e]=p.useState(!1),[d,u]=p.useState(!1);return h(f,{isOpen:o,closeIcon:!0,closeHandle:r,autoClose:a,title:"Confirmation",children:[h(v,{children:[c,s!=null&&s.show?l("div",{className:"form-group",children:h("label",{className:"checkbox",children:[l("input",{type:"checkbox",checked:d,onChange:C=>{u(C.target.checked)}}),l("span",{className:"checkbox__input"}),l("span",{className:"checkbox__label",children:s.text||"Don't ask again"})]})}):null]}),h(w,{children:[l(_.Light,{onClick:r,children:"Close"}),h(_,{color:t,disabled:m,onClick:async()=>{e(!0),await i(d)&&e(!1)},children:[n,m?l("span",{className:"icon-animation spin qtr-margin-left"}):null]})]})]})};function Q({title:o,question:t,onSave:a,onClose:n,initial:i,type:r,isOpen:c,hint:s,validate:m,autoClose:e}){const[d,u]=p.useState(i),[C,I]=p.useState(!1),R=P(async()=>{typeof m=="function"&&!await m(d)||(I(!0),await a(d),I(!1),n())});p.useEffect(()=>u(i),[i]);const k=p.useRef(void 0);return p.useEffect(()=>{c&&k.current&&k.current.focus()},[c]),h(f,{isOpen:c,closeIcon:!0,closeHandle:n,title:o,autoClose:e,children:[l(v,{children:l(Te,{type:r,onChange:M=>u(M.target.value),onKeyUp:M=>{M.key==="Enter"&&R()},name:"promptInput",value:d,label:h($,{children:[t,l(we,{condition:!!s&&typeof s=="string",children:l("span",{"data-balloon":s,"data-balloon-length":"large","data-balloon-pos":"up",children:l("span",{className:"icon-question-circle qtr-margin-left",style:{cursor:"help"}})})})]}),ref:k})}),h(w,{children:[l(_,{color:"light",onClick:n,disabled:C,children:"Close"}),h(_,{color:"primary",onClick:R,disabled:C,children:["OK",C?l("span",{className:"icon-animation spin qtr-margin-left"}):null]})]})]})}function Pe(o){throw new Error(`Unexpected value ${o}`)}const Ie=({fullBody:o,body:t,buttons:a,modalProps:n,id:i,shown:r,title:c,close:s,isLast:m})=>T(f,{...n,key:i,isOpen:r,closeHandle:s,title:c,autoClose:m?n?.autoClose:!1},o?typeof o=="function"?o({close:s}):ie(o,{close:s}):h($,{children:[l(v,{children:t}),l(w,{children:a.map((e,d)=>l(_,{color:e.color||"light",onClick:u=>{typeof e.onClick=="function"?e.onClick(u,s):s()},children:e.text},d))})]})),Re=({id:o,body:t,button:a,close:n,isLast:i,shown:r,buttonColor:c,title:s})=>h(f,{isOpen:r,closeIcon:!0,closeHandle:n,title:s,autoClose:i?void 0:!1,children:[l(v,{children:t}),l(w,{children:l(_,{color:c||"light",onClick:n,children:a})})]},o),Ee=({cb:o,close:t,id:a,isLast:n,question:i,shown:r,hint:c,initial:s,options:m,title:e,type:d})=>{let u;return typeof m<"u"&&({initial:s="",type:d="text",hint:c=void 0,validate:u=void 0}=m),l(Q,{isOpen:r,onClose:t,onSave:o,title:e,question:i,initial:s,type:d,hint:c,validate:u,autoClose:n?void 0:!1},a)},Fe=({close:o,id:t,isLast:a,onConfirm:n,prompt:i,shown:r,confirmText:c,confirmType:s,dontAskAgain:m})=>l(U,{isOpen:r,prompt:i,confirmHandle:async e=>(await n(e)&&o(),!0),closeHandle:o,confirmText:c,confirmType:s,dontAskAgain:m,autoClose:a?void 0:!1},t),H=({closeTimeout:o=300,...t})=>{var a;const[n,i]=p.useState([]),r=p.useCallback(e=>i(d=>[...d,{id:xe(),shown:!0,...e}]),[]),c=p.useCallback(e=>{i(d=>d.map(u=>u.id===e?{...u,shown:!1}:u))},[]),s=P(e=>{i(d=>d.filter(u=>(u.id===e&&typeof u.onClosed=="function"&&u.onClosed(),u.id!==e)))}),m=P((e,d)=>{c(e),setTimeout(()=>s(e),o),d&&d()});return p.useEffect(()=>{const e=d=>r(d);return g.on("showModal",e),()=>{g.off("showModal",e)}},[r]),l(j,{withPortal:!0,portalId:(a=t.portalId)!=null?a:"--cui-modal-portal",portalRoot:t.portalRoot,children:n.length>0?n.map((e,d)=>{switch(e.modalType){case"dynamic":return T(Ie,{...e,key:e.id,close:()=>m(e.id,e.onModalClose),isLast:d===n.length-1});case"notification":return T(Re,{...e,key:e.id,close:()=>m(e.id,e.onModalClose),isLast:d===n.length-1});case"prompt":return T(Ee,{...e,key:e.id,close:()=>m(e.id,e.onModalClose),isLast:d===n.length-1});case"confirmation":return T(Fe,{...e,key:e.id,close:()=>m(e.id,e.onModalClose),isLast:d===n.length-1});default:return Pe(e)}}):null})},G=ae(null),J=()=>re(G),Oe=({children:o,closeTimeout:t,portalId:a,portalRoot:n})=>{const i=se([]),r=q(m=>{i.current=[...i.current,m]},[]),c=q(m=>{i.current=i.current.filter(e=>e!==m)},[]),s=q(()=>i.current.length>0?i.current[i.current.length-1]:null,[]);return h(G.Provider,{value:de(()=>({rendered:i,addRendered:r,removeRendered:c,lastRendered:s}),[i,r,c,s]),children:[o,l(H,{closeTimeout:t,portalId:a,portalRoot:n})]})},f=({size:o=null,autoClose:t=!0,animationDuration:a=250,closeIcon:n=!1,title:i=null,closeHandle:r=null,left:c=!1,dialogProps:s=null,contentProps:m=null,maximize:e=!1,children:d,isOpen:u,refElement:C,root:I,lockScroll:R,ancestorScroll:k,portalId:M})=>{const[F,z]=p.useState(!1),b=ce(),N=J(),O=P(y=>{N&&(y?N.addRendered(b):N.removeRendered(b))});p.useEffect(()=>(z(!1),O(u),()=>O(!1)),[u,O]);const A=p.useMemo(()=>F?"full":o,[F,o]),{reference:X,floating:Y,context:x}=me({open:u,onOpenChange:y=>y?void 0:void r(),nodeId:b}),Z=ue();p.useEffect(()=>{C&&X(C)},[C]);const ee=P(()=>!N||N.lastRendered()===b),{getFloatingProps:oe}=pe([fe(x),he(x,{role:"dialog"}),Ce(x,{enabled:t,escapeKey:!1,ancestorScroll:k,bubbles:!1,outsidePress:ee}),Ne(x,{enabled:t,modal:!0})]),B=p.useRef(null),D=p.useRef(null),{id:le,root:ne}=ke({root:I,portalId:M,fallbackPortalId:"--cui-modal-portal"});return l(j,{withPortal:!Z,portalId:le,portalRoot:ne,children:l(ye,{id:b,children:l(_e,{in:u,mountOnEnter:!0,unmountOnExit:!0,appear:!0,timeout:a,nodeRef:B,children:y=>l(ge,{className:E("modal-backdrop",{"modal-backdrop--before-close":y==="exiting"}),lockScroll:R,ref:B,id:b,children:l(be,{context:x,modal:!0,children:l("div",{className:E("modal","modal_transitions",{[`modal--${A}`]:!!A,"modal--left":!!c}),children:l("div",{ref:Y,...oe({...s,className:E("modal__dialog",{[W.modal__dialog__appear]:y==="entering",[W.modal__dialog__open]:y==="entered",[s?.className]:s?.className})}),children:l(Me,{rootRef:D,children:h("div",{className:"modal__content",ref:D,...m,children:[n&&r||e?h(ve,{condition:!!(n&&r)&&e,wrapper:l("div",{className:"modal__close"}),children:[!!e&&l("a",{className:E({modal__close:!(n&&r),"qtr-margin-right":n&&r}),onClick:()=>z(te=>!te),children:l("span",{className:F?"icon-minimize":"icon-maximize"})}),!!(n&&r)&&l("a",{className:e?"":"modal__close",onClick:r,children:l("span",{className:"icon-close"})})]}):null,!!i&&l(L,{children:l("h1",{className:"modal__title",children:i})}),d]})})})})})})})})})};f.Small=o=>l(f,{...o,size:"small"}),f.Large=o=>l(f,{...o,size:"large"}),f.Full=o=>l(f,{...o,size:"full"}),f.Fluid=o=>l(f,{...o,size:"fluid"}),f.Header=L,f.Body=v,f.Footer=w;function Se(o,t,a="primary",n="Confirm",i={show:!1}){if(!o)throw new Error("Prompt must be specified");if(!t||typeof t!="function")throw new Error("onConfirm must be specified and must be a function");return new Promise(r=>g.emit("showModal",{modalType:"confirmation",prompt:l("p",{children:o}),onConfirm:t,confirmText:n,confirmType:a,dontAskAgain:i,onModalClose:r}))}const V=(o,t,a="light",n="OK")=>{if(!o||!t)throw new Error("Title and body must be specified");return new Promise(i=>{g.emit("showModal",{modalType:"notification",title:o,body:t,buttonColor:a,button:n,onClosed:i})})};function qe(o,t,a,n,i="text",r=void 0){if(!o||!t)throw new Error("Title and question must be specified");return typeof n=="object"?new Promise(c=>g.emit("showModal",{modalType:"prompt",title:o,question:t,cb:a,options:n,onModalClose:c})):new Promise(c=>g.emit("showModal",{modalType:"prompt",title:o,initial:n,type:i,question:t,cb:a,hint:r,onModalClose:c}))}const Le=({title:o,fullBody:t=null,body:a=null,buttons:n=[],modalProps:i={}})=>new Promise(r=>{g.emit("showModal",{modalType:"dynamic",title:o,fullBody:t,body:a,buttons:n,modalProps:i,onModalClose:r})});export{H as ConfirmationListener,U as ConfirmationModal,H as DynamicModal,f as Modal,v as ModalBody,w as ModalFooter,L as ModalHeader,Oe as ModalProvider,Q as PromptModal,Se as confirmation,Le as dynamicModal,V as notification,V as notificationModal,qe as prompt,J as useModalProvider};
//# sourceMappingURL=index.js.map
