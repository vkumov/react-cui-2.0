import e,{forwardRef as q,cloneElement as V}from"react";import{appendClass as x}from"../utils/index.js";import{useFloatingNodeId as X,useFloating as Y,useFloatingTree as Z,useInteractions as $,useClick as ee,useRole as te,useDismiss as oe,FloatingNode as le,FloatingOverlay as ne,FloatingFocusManager as ae}from"@floating-ui/react";import M from"classnames";import{Transition as ie}from"react-transition-group";import{ConditionalWrapper as re,DisplayIf as se}from"../Conditional/index.js";import{useFloatingContext as ce,FloatingTreeWrapper as H,FloatingProvider as me}from"../FloatingProvider/index.js";import{useCustomDismiss as de}from"../hooks/useCustomDismiss.js";import{Button as y}from"../Button/index.js";import F from"react-use-event-hook";import{Input as ue}from"../Input/index.js";import{nanoid as pe}from"nanoid";import{eventManager as E}from"../utils/eventManager.js";const P=({className:t=null,children:n,...a})=>e.createElement("div",{className:`modal__header${x(t)}`,...a},n),h=q(({className:t=null,children:n,...a},l)=>e.createElement("div",{className:`modal__footer${x(t)}`,...a,ref:l},n)),g=q(({className:t=null,children:n,...a},l)=>e.createElement("div",{className:`modal__body${x(t)}`,...a,ref:l},n));var R={modal__dialog__appear:"Modal-module_modal__dialog__appear__y9Qy2"};const u=({size:t=null,autoClose:n=!0,animationDuration:a=250,closeIcon:l=!1,title:c=null,closeHandle:s=null,left:m=!1,dialogProps:r=null,contentProps:o=null,maximize:i=!1,children:d,isOpen:p,refElement:f,root:k,lockScroll:v,ancestorScroll:C,portalId:b})=>{const[N,O]=e.useState(!1);e.useEffect(()=>O(!1),[p]);const I=e.useMemo(()=>N?"full":t,[N,t]),T=X(),{reference:K,floating:W,context:_}=Y({open:p,onOpenChange:w=>w?void 0:void s(),nodeId:T}),U=Z();e.useEffect(()=>{f&&K(f)},[f]);const{getFloatingProps:j}=$([ee(_),te(_,{role:"dialog"}),oe(_,{enabled:n,escapeKey:!1,ancestorScroll:C,bubbles:!1,outsidePress:!0}),de(_,{enabled:n})]),S=e.useRef(null),L=e.useRef(null),{id:Q,root:G}=ce({root:k,portalId:b,fallbackPortalId:"--cui-modal-portal"});return e.createElement(H,{withPortal:!U,portalId:Q,portalRoot:G},e.createElement(le,{id:T},e.createElement(ie,{in:p,mountOnEnter:!0,unmountOnExit:!0,appear:!0,timeout:a,nodeRef:S},w=>e.createElement(ne,{className:M("modal-backdrop",{"modal-backdrop--before-close":w==="exiting"}),lockScroll:v,ref:S,id:T},e.createElement(ae,{context:_,modal:!0},e.createElement("div",{className:M("modal","modal_transitions",{[`modal--${I}`]:!!I,"modal--left":!!m})},e.createElement("div",{ref:W,...j({...r,className:M("modal__dialog",{[R.modal__dialog__appear]:w==="entering",[R.modal__dialog__open]:w==="entered",[r?.className]:r?.className})})},e.createElement(me,{rootRef:L},e.createElement("div",{className:"modal__content",ref:L,...o},l&&s||i?e.createElement(re,{condition:!!(l&&s)&&i,wrapper:e.createElement("div",{className:"modal__close"})},!!i&&e.createElement("a",{className:M({modal__close:!(l&&s),"qtr-margin-right":l&&s}),onClick:()=>O(J=>!J)},e.createElement("span",{className:N?"icon-minimize":"icon-maximize"})),!!(l&&s)&&e.createElement("a",{className:i?"":"modal__close",onClick:s},e.createElement("span",{className:"icon-close"}))):null,!!c&&e.createElement(P,null,e.createElement("h1",{className:"modal__title"},c)),d)))))))))};u.Small=t=>e.createElement(u,{...t,size:"small"}),u.Large=t=>e.createElement(u,{...t,size:"large"}),u.Full=t=>e.createElement(u,{...t,size:"full"}),u.Fluid=t=>e.createElement(u,{...t,size:"fluid"}),u.Header=P,u.Body=g,u.Footer=h;const z=({isOpen:t=!1,confirmType:n="primary",autoClose:a=!0,confirmText:l="Confirm",confirmHandle:c,closeHandle:s,prompt:m,dontAskAgain:r={show:!1}})=>{const[o,i]=e.useState(!1),[d,p]=e.useState(!1);return e.createElement(u,{isOpen:t,closeIcon:!0,closeHandle:s,autoClose:a,title:"Confirmation"},e.createElement(g,null,m,r!=null&&r.show?e.createElement("div",{className:"form-group"},e.createElement("label",{className:"checkbox"},e.createElement("input",{type:"checkbox",checked:d,onChange:f=>{p(f.target.checked)}}),e.createElement("span",{className:"checkbox__input"}),e.createElement("span",{className:"checkbox__label"},r.text||"Don't ask again"))):null),e.createElement(h,null,e.createElement(y.Light,{onClick:s},"Close"),e.createElement(y,{color:n,disabled:o,onClick:async()=>{i(!0),await c(d)&&i(!1)}},l,o?e.createElement("span",{className:"icon-animation spin qtr-margin-left"}):null)))};function A({title:t,question:n,onSave:a,onClose:l,initial:c,type:s,isOpen:m,hint:r,validate:o,autoClose:i}){const[d,p]=e.useState(c),[f,k]=e.useState(!1),v=F(async()=>{typeof o=="function"&&!await o(d)||(k(!0),await a(d),k(!1),l())});e.useEffect(()=>p(c),[c]);const C=e.useRef(void 0);return e.useEffect(()=>{m&&C.current&&C.current.focus()},[m]),e.createElement(u,{isOpen:m,closeIcon:!0,closeHandle:l,title:t,autoClose:i},e.createElement(g,null,e.createElement(ue,{type:s,onChange:b=>p(b.target.value),onKeyUp:b=>{b.key==="Enter"&&v()},name:"promptInput",value:d,label:e.createElement(e.Fragment,null,n,e.createElement(se,{condition:!!r&&typeof r=="string"},e.createElement("span",{"data-balloon":r,"data-balloon-length":"large","data-balloon-pos":"up"},e.createElement("span",{className:"icon-question-circle qtr-margin-left",style:{cursor:"help"}})))),ref:C})),e.createElement(h,null,e.createElement(y,{color:"light",onClick:l,disabled:f},"Close"),e.createElement(y,{color:"primary",onClick:v,disabled:f},"OK",f?e.createElement("span",{className:"icon-animation spin qtr-margin-left"}):null)))}function fe(t){throw new Error(`Unexpected value ${t}`)}const Ee=({fullBody:t,body:n,buttons:a,modalProps:l,id:c,shown:s,title:m,close:r,isLast:o})=>e.createElement(u,{...l,key:c,isOpen:s,closeHandle:r,title:m,autoClose:o?l?.autoClose:!1},t?typeof t=="function"?t({close:r}):V(t,{close:r}):e.createElement(e.Fragment,null,e.createElement(g,null,n),e.createElement(h,null,a.map((i,d)=>e.createElement(y,{key:d,color:i.color||"light",onClick:p=>{typeof i.onClick=="function"?i.onClick(p,r):r()}},i.text))))),ye=({id:t,body:n,button:a,close:l,isLast:c,shown:s,buttonColor:m,title:r})=>e.createElement(u,{key:t,isOpen:s,closeIcon:!0,closeHandle:l,title:r,autoClose:c?void 0:!1},e.createElement(g,null,n),e.createElement(h,null,e.createElement(y,{color:m||"light",onClick:l},a))),he=({cb:t,close:n,id:a,isLast:l,question:c,shown:s,hint:m,initial:r,options:o,title:i,type:d})=>{let p;return typeof o<"u"&&({initial:r="",type:d="text",hint:m=void 0,validate:p=void 0}=o),e.createElement(A,{key:a,isOpen:s,onClose:n,onSave:t,title:i,question:c,initial:r,type:d,hint:m,validate:p,autoClose:l?void 0:!1})},ge=({close:t,id:n,isLast:a,onConfirm:l,prompt:c,shown:s,confirmText:m,confirmType:r,dontAskAgain:o})=>e.createElement(z,{key:n,isOpen:s,prompt:c,confirmHandle:async i=>(await l(i)&&t(),!0),closeHandle:t,confirmText:m,confirmType:r,dontAskAgain:o,autoClose:a?void 0:!1}),B=({closeTimeout:t=300,...n})=>{const[a,l]=e.useState([]),c=e.useCallback(o=>l(i=>[...i,{id:pe(),shown:!0,...o}]),[]),s=e.useCallback(o=>{l(i=>i.map(d=>d.id===o?{...d,shown:!1}:d))},[]),m=F(o=>{l(i=>i.filter(d=>(d.id===o&&typeof d.onClosed=="function"&&d.onClosed(),d.id!==o)))}),r=F((o,i)=>{s(o),setTimeout(()=>m(o),t),i&&i()});return e.useEffect(()=>{const o=i=>c(i);return E.on("showModal",o),()=>{E.off("showModal",o)}},[c]),e.createElement(H,{withPortal:!0,portalId:n.id,portalRoot:n.root},a.length>0?a.map((o,i)=>{switch(o.modalType){case"dynamic":return e.createElement(Ee,{...o,key:o.id,close:()=>r(o.id,o.onModalClose),isLast:i===a.length-1});case"notification":return e.createElement(ye,{...o,key:o.id,close:()=>r(o.id,o.onModalClose),isLast:i===a.length-1});case"prompt":return e.createElement(he,{...o,key:o.id,close:()=>r(o.id,o.onModalClose),isLast:i===a.length-1});case"confirmation":return e.createElement(ge,{...o,key:o.id,close:()=>r(o.id,o.onModalClose),isLast:i===a.length-1});default:return fe(o)}}):null)};function Ce(t,n,a="primary",l="Confirm",c={show:!1}){if(!t)throw new Error("Prompt must be specified");if(!n||typeof n!="function")throw new Error("onConfirm must be specified and must be a function");return new Promise(s=>E.emit("showModal",{modalType:"confirmation",prompt:e.createElement("p",null,t),onConfirm:n,confirmText:l,confirmType:a,dontAskAgain:c,onModalClose:s}))}const D=(t,n,a="light",l="OK")=>{if(!t||!n)throw new Error("Title and body must be specified");return new Promise(c=>{E.emit("showModal",{modalType:"notification",title:t,body:n,buttonColor:a,button:l,onClosed:c})})};function be(t,n,a,l,c="text",s=void 0){if(!t||!n)throw new Error("Title and question must be specified");return typeof l=="object"?new Promise(m=>E.emit("showModal",{modalType:"prompt",title:t,question:n,cb:a,options:l,onModalClose:m})):new Promise(m=>E.emit("showModal",{modalType:"prompt",title:t,initial:l,type:c,question:n,cb:a,hint:s,onModalClose:m}))}const _e=({title:t,fullBody:n=null,body:a=null,buttons:l=[],modalProps:c={}})=>new Promise(s=>{E.emit("showModal",{modalType:"dynamic",title:t,fullBody:n,body:a,buttons:l,modalProps:c,onModalClose:s})});export{B as ConfirmationListener,z as ConfirmationModal,B as DynamicModal,u as Modal,g as ModalBody,h as ModalFooter,P as ModalHeader,A as PromptModal,Ce as confirmation,_e as dynamicModal,D as notification,D as notificationModal,be as prompt};
//# sourceMappingURL=index.js.map
