import{jsx as o,jsxs as C,Fragment as S}from"react/jsx-runtime";import{appendClass as H}from"../utils/index.js";import f,{forwardRef as W,createElement as T,cloneElement as ie,createContext as ae,useContext as re,useRef as se,useCallback as L,useMemo as de}from"react";import{useFloatingPortalNode as ce,useFloatingNodeId as me,useFloating as ue,useFloatingTree as pe,useInteractions as fe,useClick as he,useRole as Ce,useDismiss as ye,FloatingNode as ge,FloatingOverlay as be,FloatingFocusManager as _e}from"@floating-ui/react";import F from"classnames";import{Transition as we}from"react-transition-group";import P from"react-use-event-hook";import{DisplayIf as ve,ConditionalWrapper as ke}from"../Conditional/index.js";import{FloatingTreeWrapper as j,useFloatingContext as Me,FloatingProvider as Ne}from"../FloatingProvider/index.js";import{useCustomDismiss as xe}from"../hooks/useCustomDismiss.js";import{nanoid as Te}from"nanoid";import{Button as _}from"../Button/index.js";import{eventManager as g}from"../utils/eventManager.js";import{Input as Pe}from"../Input/index.js";const q=({className:e=null,children:i,...r})=>o("div",{className:`modal__header${H(e)}`,...r,children:i}),w=W(({className:e=null,children:i,...r},n)=>o("div",{className:`modal__footer${H(e)}`,...r,ref:n,children:i})),v=W(({className:e=null,children:i,...r},n)=>o("div",{className:`modal__body${H(e)}`,...r,ref:n,children:i}));var U={modal__dialog__appear:"Modal-module_modal__dialog__appear__y9Qy2"};const $=({isOpen:e=!1,confirmType:i="primary",autoClose:r=!0,confirmText:n="Confirm",confirmHandle:t,closeHandle:a,prompt:c,dontAskAgain:s={show:!1}})=>{const[u,m]=f.useState(!1),[l,d]=f.useState(!1);return C(h,{isOpen:e,closeIcon:!0,closeHandle:a,autoClose:r,title:"Confirmation",children:[C(v,{children:[c,s!=null&&s.show?o("div",{className:"form-group",children:C("label",{className:"checkbox",children:[o("input",{type:"checkbox",checked:l,onChange:p=>{d(p.target.checked)}}),o("span",{className:"checkbox__input"}),o("span",{className:"checkbox__label",children:s.text||"Don't ask again"})]})}):null]}),C(w,{children:[o(_.Light,{onClick:a,children:"Close"}),C(_,{color:i,disabled:u,onClick:async()=>{m(!0),await t(l)&&m(!1)},children:[n,u?o("span",{className:"icon-animation spin qtr-margin-left"}):null]})]})]})};function Q({title:e,question:i,onSave:r,onClose:n,initial:t,type:a,isOpen:c,hint:s,validate:u,autoClose:m}){const[l,d]=f.useState(t),[p,I]=f.useState(!1),R=P(async()=>{typeof u=="function"&&!await u(l)||(I(!0),await r(l),I(!1),n())});f.useEffect(()=>d(t),[t]);const k=f.useRef(void 0);return f.useEffect(()=>{c&&k.current&&k.current.focus()},[c]),C(h,{isOpen:c,closeIcon:!0,closeHandle:n,title:e,autoClose:m,children:[o(v,{children:o(Pe,{type:a,onChange:M=>d(M.target.value),onKeyUp:M=>{M.key==="Enter"&&R()},name:"promptInput",value:l,label:C(S,{children:[i,o(ve,{condition:!!s&&typeof s=="string",children:o("span",{"data-balloon":s,"data-balloon-length":"large","data-balloon-pos":"up",children:o("span",{className:"icon-question-circle qtr-margin-left",style:{cursor:"help"}})})})]}),ref:k})}),C(w,{children:[o(_,{color:"light",onClick:n,disabled:p,children:"Close"}),C(_,{color:"primary",onClick:R,disabled:p,children:["OK",p?o("span",{className:"icon-animation spin qtr-margin-left"}):null]})]})]})}function Ie(e){throw new Error(`Unexpected value ${e}`)}const Re=({fullBody:e,body:i,buttons:r,modalProps:n,id:t,shown:a,title:c,close:s,isLast:u})=>T(h,{...n,key:t,isOpen:a,closeHandle:s,title:c,autoClose:u?n?.autoClose:!1},e?typeof e=="function"?e({close:s}):ie(e,{close:s}):C(S,{children:[o(v,{children:i}),o(w,{children:r.map((m,l)=>o(_,{color:m.color||"light",onClick:d=>{typeof m.onClick=="function"?m.onClick(d,s):s()},children:m.text},l))})]})),Fe=({id:e,body:i,button:r,close:n,isLast:t,shown:a,buttonColor:c,title:s})=>C(h,{isOpen:a,closeIcon:!0,closeHandle:n,title:s,autoClose:t?void 0:!1,children:[o(v,{children:i}),o(w,{children:o(_,{color:c||"light",onClick:n,children:r})})]},e),Ee=({cb:e,close:i,id:r,isLast:n,question:t,shown:a,hint:c,initial:s,options:u,title:m,type:l})=>{let d;return typeof u<"u"&&({initial:s="",type:l="text",hint:c=void 0,validate:d=void 0}=u),o(Q,{isOpen:a,onClose:i,onSave:e,title:m,question:t,initial:s,type:l,hint:c,validate:d,autoClose:n?void 0:!1},r)},Oe=({close:e,id:i,isLast:r,onConfirm:n,prompt:t,shown:a,confirmText:c,confirmType:s,dontAskAgain:u})=>o($,{isOpen:a,prompt:t,confirmHandle:async m=>(await n(m)&&e(),!0),closeHandle:e,confirmText:c,confirmType:s,dontAskAgain:u,autoClose:r?void 0:!1},i),z=({closeTimeout:e=300,...i})=>{var r,n;const[t,a]=f.useState([]);ce({id:(r=i.portalId)!=null?r:"--cui-modal-portal"});const c=f.useCallback(l=>a(d=>[...d,{id:Te(),shown:!0,...l}]),[]),s=f.useCallback(l=>{a(d=>d.map(p=>p.id===l?{...p,shown:!1}:p))},[]),u=P(l=>{a(d=>d.filter(p=>(p.id===l&&typeof p.onClosed=="function"&&p.onClosed(),p.id!==l)))}),m=P((l,d)=>{s(l),setTimeout(()=>u(l),e),d&&d()});return f.useEffect(()=>{const l=d=>c(d);return g.on("showModal",l),()=>{g.off("showModal",l)}},[c]),o(S,{children:t.length>0?o(j,{withPortal:!0,portalId:(n=i.portalId)!=null?n:"--cui-modal-portal",portalRoot:i.portalRoot,children:t.map((l,d)=>{switch(l.modalType){case"dynamic":return T(Re,{...l,key:l.id,close:()=>m(l.id,l.onModalClose),isLast:d===t.length-1});case"notification":return T(Fe,{...l,key:l.id,close:()=>m(l.id,l.onModalClose),isLast:d===t.length-1});case"prompt":return T(Ee,{...l,key:l.id,close:()=>m(l.id,l.onModalClose),isLast:d===t.length-1});case"confirmation":return T(Oe,{...l,key:l.id,close:()=>m(l.id,l.onModalClose),isLast:d===t.length-1});default:return Ie(l)}})}):null})},G=ae(null),J=()=>re(G),Se=({children:e,closeTimeout:i,portalId:r,portalRoot:n})=>{const t=se([]),a=L(u=>{t.current=[...t.current,u]},[]),c=L(u=>{t.current=t.current.filter(m=>m!==u)},[]),s=L(()=>t.current.length>0?t.current[t.current.length-1]:null,[]);return C(G.Provider,{value:de(()=>({rendered:t,addRendered:a,removeRendered:c,lastRendered:s}),[t,a,c,s]),children:[e,o(z,{closeTimeout:i,portalId:r,portalRoot:n})]})},h=({size:e=null,autoClose:i=!0,animationDuration:r=250,closeIcon:n=!1,title:t=null,closeHandle:a=null,left:c=!1,dialogProps:s=null,contentProps:u=null,maximize:m=!1,children:l,isOpen:d,refElement:p,root:I,lockScroll:R,ancestorScroll:k,portalId:M})=>{const[E,A]=f.useState(!1),b=me(),N=J(),O=P(y=>{N&&(y?N.addRendered(b):N.removeRendered(b))});f.useEffect(()=>(A(!1),O(d),()=>O(!1)),[d,O]);const B=f.useMemo(()=>E?"full":e,[E,e]),{reference:X,floating:Y,context:x}=ue({open:d,onOpenChange:y=>!y&&a?void a():void 0,nodeId:b}),Z=pe();f.useEffect(()=>{p&&X(p)},[p]);const ee=P(()=>!N||N.lastRendered()===b),{getFloatingProps:oe}=fe([he(x),Ce(x,{role:"dialog"}),ye(x,{enabled:i,escapeKey:!1,ancestorScroll:k,bubbles:!1,outsidePress:ee}),xe(x,{enabled:i,modal:!0})]),D=f.useRef(null),K=f.useRef(null),{id:le,root:ne}=Me({root:I,portalId:M,fallbackPortalId:"--cui-modal-portal"});return o(we,{in:d,mountOnEnter:!0,unmountOnExit:!0,appear:!0,timeout:r,nodeRef:D,children:y=>o(j,{withPortal:!Z,portalId:le,portalRoot:ne,children:o(ge,{id:b,children:o(be,{className:F("modal-backdrop",{"modal-backdrop--before-close":y==="exiting"}),lockScroll:R,ref:D,id:b,children:o(_e,{context:x,modal:!0,children:o("div",{className:F("modal","modal_transitions",{[`modal--${B}`]:!!B,"modal--left":!!c}),children:o("div",{ref:Y,...oe({...s,className:F("modal__dialog",{[U.modal__dialog__appear]:y==="entering",[U.modal__dialog__open]:y==="entered",[s?.className]:s?.className})}),children:o(Ne,{rootRef:K,children:C("div",{className:"modal__content",ref:K,...u,children:[n&&a||m?C(ke,{condition:!!(n&&a)&&m,wrapper:o("div",{className:"modal__close"}),children:[!!m&&o("a",{className:F({modal__close:!(n&&a),"qtr-margin-right":n&&a}),onClick:()=>A(te=>!te),children:o("span",{className:E?"icon-minimize":"icon-maximize"})}),!!(n&&a)&&o("a",{className:m?"":"modal__close",onClick:a,children:o("span",{className:"icon-close"})})]}):null,!!t&&o(q,{children:o("h1",{className:"modal__title",children:t})}),l]})})})})})})})})})};h.Small=e=>o(h,{...e,size:"small"}),h.Large=e=>o(h,{...e,size:"large"}),h.Full=e=>o(h,{...e,size:"full"}),h.Fluid=e=>o(h,{...e,size:"fluid"}),h.Header=q,h.Body=v,h.Footer=w;function He(e,i,r="primary",n="Confirm",t={show:!1}){if(!e)throw new Error("Prompt must be specified");if(!i||typeof i!="function")throw new Error("onConfirm must be specified and must be a function");return new Promise(a=>g.emit("showModal",{modalType:"confirmation",prompt:o("p",{children:e}),onConfirm:i,confirmText:n,confirmType:r,dontAskAgain:t,onModalClose:a}))}const V=(e,i,r="light",n="OK")=>{if(!e||!i)throw new Error("Title and body must be specified");return new Promise(t=>{g.emit("showModal",{modalType:"notification",title:e,body:i,buttonColor:r,button:n,onClosed:t})})};function Le(e,i,r,n,t="text",a=void 0){if(!e||!i)throw new Error("Title and question must be specified");return typeof n=="object"?new Promise(c=>g.emit("showModal",{modalType:"prompt",title:e,question:i,cb:r,options:n,onModalClose:c})):new Promise(c=>g.emit("showModal",{modalType:"prompt",title:e,initial:n,type:t,question:i,cb:r,hint:a,onModalClose:c}))}const qe=({title:e,fullBody:i=null,body:r=null,buttons:n=[],modalProps:t={}})=>new Promise(a=>{g.emit("showModal",{modalType:"dynamic",title:e,fullBody:i,body:r,buttons:n,modalProps:t,onModalClose:a})});export{z as ConfirmationListener,$ as ConfirmationModal,z as DynamicModal,h as Modal,v as ModalBody,w as ModalFooter,q as ModalHeader,Se as ModalProvider,Q as PromptModal,He as confirmation,qe as dynamicModal,V as notification,V as notificationModal,Le as prompt,J as useModalProvider};
//# sourceMappingURL=index.js.map
