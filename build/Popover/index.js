import{jsx as e,jsxs as j,Fragment as xe}from"react/jsx-runtime";import{forwardRef as z,useRef as _,useEffect as Oe,createContext as U,useContext as Y,useState as B,useCallback as H,useImperativeHandle as be,cloneElement as Fe,createElement as we}from"react";import{useMergeRefs as x,useFloatingTree as Ne,useFloatingNodeId as Ce,useFloating as $,offset as G,flip as V,shift as W,autoUpdate as X,useInteractions as Z,useClick as ee,useDismiss as oe,FloatingNode as Ee,FloatingOverlay as Ie,FloatingFocusManager as re,FloatingPortal as Re}from"@floating-ui/react";import O from"classnames";import{Transition as J}from"react-transition-group";import{useFloatingContext as te,FloatingTreeWrapper as ke}from"../FloatingProvider/index.js";import{useCustomDismiss as ne}from"../hooks/useCustomDismiss.js";import{useLockedBody as le}from"../hooks/useLockedBody.js";var b={wrapper:"Popover-module_wrapper__m7aDv",body:"Popover-module_body__ytz0O",popover_appear:"Popover-module_popover_appear__dJaAP",disappear:"Popover-module_disappear__w-dyh",popover_disappear:"Popover-module_popover_disappear__taph3",overlay:"Popover-module_overlay__u9dvj",overlay_appear:"Popover-module_overlay_appear__b1qOJ",overlay_disappear:"Popover-module_overlay_disappear__tQSBY"};const K=z(function({className:o,children:r,wrapperClassName:l,state:n,offset:t,...s},h){const u=_(null),m=x([h,u]);return Oe(()=>{var c;const a=u.current;return a&&t&&typeof t!="function"&&a.style.setProperty("--offset",`${typeof t=="number"?t:(c=t.mainAxis)!=null?c:4}px`),()=>{a&&a.style.setProperty("--offset","4px")}},[t]),e("div",{ref:m,className:O(b.wrapper,l,{[b.disappear]:n==="exiting"||n==="exited"}),...s,children:e("div",{className:O("panel panel--bordered panel--raised",b.body,o),tabIndex:-1,children:r})})}),ae=U(null),De=({children:o,...r})=>e(ae.Provider,{value:r,children:o}),Me=()=>Y(ae),Te=({show:o,children:r,background:l="var(--cui-background-color)",className:n})=>{const t=_(null);return e(J,{in:o,mountOnEnter:!0,unmountOnExit:!0,timeout:250,nodeRef:t,children:s=>e("div",{style:{background:l},className:O(b.overlay,n,{[b.disappear]:s==="exiting"||s==="exited"}),ref:t,children:r})})},se=U(null),Ae=()=>{const o=Y(se);if(!o)throw Error("usePopoverHandlers can be used only inside Popover");return o.current},Se=z(function({children:o,element:r,onClose:l,onOpen:n,showClassName:t,overlay:s,showOverlay:h,placement:u,portalRoot:m,offset:c=4,closeRef:a,initialFocus:f,guardsFocus:d,modalFocus:F,closeOnFocusOut:w,portalId:k,wrapperClassName:N,className:D,explicitPortal:v,autoDismiss:M=!0},T){const[g,i]=le(!1,"root"),[C,E]=B(M),A=Ne(),y=Ce(),{x:I,y:p,reference:S,floating:pe,strategy:ce,context:R}=$({placement:u,middleware:[G(c),V(),W({padding:{left:8,right:8}})],open:g,onOpenChange:P=>{P&&typeof n=="function"&&n(),!P&&typeof l=="function"&&l(),i(P)},whileElementsMounted:X,nodeId:y}),{getReferenceProps:de,getFloatingProps:ue}=Z([ee(R),oe(R,{escapeKey:!1,bubbles:!1,enabled:C}),ne(R,{enabled:C})]),[me,fe]=B(h),[ve,he]=B(s),ge=x([S,r.ref]),q=_(null),L=x([q,pe]),{root:ye,id:Pe}=te({root:m,portalId:k,fallbackPortalId:"--cui-popover-portal"}),_e=H(()=>i(!1),[i]);a&&(a.current=_e);const Q=_(null);return be(x([T,Q]),()=>({close:()=>i(!1),open:()=>i(!0),setAutoDismiss:E}),[i]),j(se.Provider,{value:Q,children:[Fe(r,de({ref:ge,...r.props,className:O(r.props.className,t?{[t]:g}:void 0)})),e(ke,{withPortal:v||!A,portalId:Pe,portalRoot:ye,children:e(Ee,{id:y,children:e(J,{in:g,mountOnEnter:!0,unmountOnExit:!0,timeout:250,nodeRef:q,children:P=>e(Ie,{style:{zIndex:"calc(var(--cui-max-zindex, 1000) + 2)"},id:y,children:e(re,{context:R,initialFocus:f??L,guards:d,modal:F,closeOnFocusOut:w,children:e(K,{ref:L,style:{position:ce,top:p??0,left:I??0},state:P,offset:c,wrapperClassName:N,...ue({className:D}),children:j(De,{setOverlayState:fe,setOverlay:he,children:[e(Te,{show:me||!1,children:ve}),o]})})})})})})})]})}),ie=z(({className:o,noLine:r,...l},n)=>j(xe,{children:[e("h5",{ref:n,className:O("no-margin-bottom",o),...l}),!r&&e("hr",{className:"half-margin-top"})]}));ie.displayName="PopoverTitle";function je({onClose:o,onOpen:r,popoverComponent:l=K,placement:n,initialFocus:t,guardsFocus:s,modalFocus:h,closeOnFocusOut:u,offset:m=4,portalRoot:c,portalId:a}){const[f,d]=le(!1,"root"),{x:F,y:w,reference:k,floating:N,strategy:D,context:v,refs:M}=$({placement:n,middleware:[G(m),V(),W({padding:{left:8,right:8}})],open:f,onOpenChange:p=>{p&&typeof r=="function"&&r(),!p&&typeof o=="function"&&o(),d(p)},whileElementsMounted:X}),{getReferenceProps:T,getFloatingProps:g}=Z([ee(v),oe(v,{bubbles:!1,escapeKey:!1}),ne(v)]),i=H(()=>d(!1),[d]),C=H(()=>d(!0),[d]),E=_(null),A=x([E,N]),{root:y,id:I}=te({root:c,portalId:a,fallbackPortalId:"--cui-popover-portal"});return{getReferenceProps:T,reference:k,render:p=>e(Re,{root:y,id:I,children:e(J,{in:f,mountOnEnter:!0,unmountOnExit:!0,timeout:250,nodeRef:E,children:S=>e(re,{context:v,initialFocus:t??N,guards:s,modal:h,closeOnFocusOut:u,children:we(l,{ref:A,state:S,offset:m,...g({style:{position:D,top:w??0,left:F??0}})},p)})})}),isShown:f,refs:M,close:i,open:C}}export{K as GenericPopover,Se as Popover,ie as PopoverTitle,je as usePopover,Me as usePopoverContext,Ae as usePopoverHandlers};
//# sourceMappingURL=index.js.map
