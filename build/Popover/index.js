import{jsx as t,jsxs as M,Fragment as Oe}from"react/jsx-runtime";import{forwardRef as S,useRef as _,useEffect as we,createContext as U,useContext as Y,useState as j,useCallback as W,useImperativeHandle as Ne,cloneElement as Ce,createElement as Re}from"react";import{useMergeRefs as P,useFloatingTree as Ee,useFloatingNodeId as Ie,useFloating as G,offset as V,flip as X,shift as Z,size as ke,autoUpdate as ee,useInteractions as oe,useClick as te,useDismiss as re,FloatingNode as Te,FloatingOverlay as ze,FloatingFocusManager as ne,FloatingPortal as De}from"@floating-ui/react";import b from"classnames";import{Transition as $}from"react-transition-group";import{useFloatingContext as ae,FloatingTreeWrapper as He}from"../FloatingProvider/index.js";import{useCustomDismiss as le}from"../hooks/useCustomDismiss.js";import{useLockedBody as se}from"../hooks/useLockedBody.js";var F={wrapper:"Popover-module_wrapper__m7aDv",body:"Popover-module_body__ytz0O",popover_appear:"Popover-module_popover_appear__dJaAP",disappear:"Popover-module_disappear__w-dyh",popover_disappear:"Popover-module_popover_disappear__taph3",overlay:"Popover-module_overlay__u9dvj",overlay_appear:"Popover-module_overlay_appear__b1qOJ",overlay_disappear:"Popover-module_overlay_disappear__tQSBY"};const A=S(function({className:e,children:o,wrapperClassName:a,state:r,offset:n,...s},g){const m=_(null),f=P([g,m]);return we(()=>{var p;const l=m.current;return l&&n&&typeof n!="function"&&l.style.setProperty("--offset",`${typeof n=="number"?n:(p=n.mainAxis)!=null?p:4}px`),()=>{l&&l.style.setProperty("--offset","4px")}},[n]),t("div",{ref:f,className:b(F.wrapper,a,{[F.disappear]:r==="exiting"||r==="exited"}),...s,children:t("div",{className:b("panel panel--bordered panel--raised",F.body,e),tabIndex:-1,children:o})})}),ie=U(null),Me=({children:e,...o})=>t(ie.Provider,{value:o,children:e}),Se=()=>Y(ie),je=({show:e,children:o,background:a="var(--cui-background-color)",className:r})=>{const n=_(null);return t($,{in:e,mountOnEnter:!0,unmountOnExit:!0,timeout:250,nodeRef:n,children:s=>t("div",{style:{background:a},className:b(F.overlay,r,{[F.disappear]:s==="exiting"||s==="exited"}),ref:n,children:o})})},We=(e,o,a)=>{if(!e)return;if(typeof e=="boolean")return{maxWidth:`${o}px`,maxHeight:`${a-4}px`};const r={};return e.height&&(r.maxHeight=`${a-4}px`),e.width&&(r.maxWidth=`${o}px`),r},pe=U(null),$e=()=>{const e=Y(pe);if(e)return e.current},Ae=S(function({children:e,element:o,onClose:a,onOpen:r,showClassName:n,overlay:s,showOverlay:g,placement:m,portalRoot:f,offset:p=4,closeRef:l,initialFocus:v,guardsFocus:c,modalFocus:O,closeOnFocusOut:w,portalId:k,wrapperClassName:h,className:y,explicitPortal:N,autoDismiss:T=!0,overlayProps:z,limitSize:C},R){const[x,i]=se(!1,"root"),[E,d]=j(T),D=Ee(),H=Ie(),{x:B,y:J,strategy:de,context:I,refs:K}=G({placement:m,middleware:[V(p),X(),Z({padding:{left:8,right:8}}),C?ke({apply({availableHeight:u,availableWidth:be,elements:Fe}){Object.assign(Fe.floating.style,We(C,be,u))}}):void 0].filter(Boolean),open:x,onOpenChange:u=>{u&&typeof r=="function"&&r(),!u&&typeof a=="function"&&a(),i(u)},whileElementsMounted:ee,nodeId:H}),{getReferenceProps:ue,getFloatingProps:me}=oe([te(I),re(I,{escapeKey:!1,bubbles:!1,enabled:E}),le(I,{enabled:E})]),[fe,ve]=j(g),[he,ge]=j(s),ye=P([K.setReference,o.ref]),q=_(null),L=P([q,K.setFloating]),{root:xe,id:_e}=ae({root:f,portalId:k,fallbackPortalId:"--cui-popover-portal"}),Pe=W(()=>i(!1),[i]);l&&(l.current=Pe);const Q=_(null);return Ne(P([R,Q]),()=>({close:()=>i(!1),open:()=>i(!0),setAutoDismiss:d}),[i]),M(pe.Provider,{value:Q,children:[Ce(o,ue({ref:ye,...o.props,className:b(o.props.className,n?{[n]:x}:void 0)})),t(He,{withPortal:N||!D,portalId:_e,portalRoot:xe,force:N?!0:void 0,children:t(Te,{id:H,children:t($,{in:x,mountOnEnter:!0,unmountOnExit:!0,timeout:250,nodeRef:q,children:u=>t(ze,{style:{zIndex:"calc(var(--cui-max-zindex, 1000) + 2)"},...z,id:H,children:t(ne,{context:I,initialFocus:v??L,guards:c,modal:O,closeOnFocusOut:w,children:t(A,{ref:L,style:{position:de,top:J??0,left:B??0},state:u,offset:p,wrapperClassName:h,...me({className:y}),children:M(Me,{setOverlayState:ve,setOverlay:ge,children:[t(je,{show:fe||!1,children:he}),e]})})})})})})})]})}),ce=S(({className:e,noLine:o,...a},r)=>M(Oe,{children:[t("h5",{ref:r,className:b("no-margin-bottom",e),...a}),!o&&t("hr",{className:"half-margin-top"})]}));ce.displayName="PopoverTitle";function Be({onClose:e,onOpen:o,popoverComponent:a=A,placement:r,initialFocus:n,guardsFocus:s,modalFocus:g,closeOnFocusOut:m,offset:f=4,portalRoot:p,portalId:l}){const[v,c]=se(!1,"root"),{x:O,y:w,strategy:k,context:h,refs:y}=G({placement:r,middleware:[V(f),X(),Z({padding:{left:8,right:8}})],open:v,onOpenChange:d=>{d&&typeof o=="function"&&o(),!d&&typeof e=="function"&&e(),c(d)},whileElementsMounted:ee}),{getReferenceProps:N,getFloatingProps:T}=oe([te(h),re(h,{bubbles:!1,escapeKey:!1}),le(h)]),z=W(()=>c(!1),[c]),C=W(()=>c(!0),[c]),R=_(null),x=P([R,y.setFloating]),{root:i,id:E}=ae({root:p,portalId:l,fallbackPortalId:"--cui-popover-portal"});return{getReferenceProps:N,render:d=>t(De,{root:i,id:E,children:t($,{in:v,mountOnEnter:!0,unmountOnExit:!0,timeout:250,nodeRef:R,children:D=>t(ne,{context:h,initialFocus:n??y.setFloating,guards:s,modal:g,closeOnFocusOut:m,children:Re(a,{ref:x,state:D,offset:f,...T({style:{position:k,top:w??0,left:O??0}})},d)})})}),isShown:v,refs:y,close:z,open:C}}export{A as GenericPopover,Ae as Popover,ce as PopoverTitle,Be as usePopover,Se as usePopoverContext,$e as usePopoverHandlers};
//# sourceMappingURL=index.js.map
