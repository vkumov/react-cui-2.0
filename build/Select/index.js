import{jsxs as _,jsx as i}from"react/jsx-runtime";import V,{forwardRef as X,useState as j,useRef as Y,useMemo as Z,useEffect as k,isValidElement as D}from"react";import F from"react-use-event-hook";import{useMergeRefs as P}from"use-callback-ref";import{InputChips as T}from"../InputChips/index.js";import{InputHelpBlock as ee}from"../InputHelp/index.js";import{appendClass as s}from"../utils/index.js";function W(o){return o.type==="option"}function z(o){return o.type==="optgroup"}const B=({children:o,handleOptionClick:a,isSelected:t})=>V.Children.map(o,(n,d)=>D(n)?W(n)?i("a",{onClick:f=>a(f,n.props.value),className:`${s(t(n.props.value),"selected")}${s(n.props.disabled,"disabled")}`,children:n.props.children},d):z(n)?_("div",{className:"dropdown__group",children:[i("div",{className:"dropdown__group-header",children:n.props.label}),i(B,{handleOptionClick:a,isSelected:t,children:n.props.children})]},d):n:n),G=o=>{const a=[];return V.Children.forEach(o,t=>{if(!D(t))return null;W(t)&&a.push({display:t.props.children,value:t.props.value}),z(t)&&a.push(G(t.props.children))}),a.flat()},le=X(({compressed:o=!1,prompt:a="Select an option",inline:t=!1,type:n="text",children:d,label:f=null,error:N=null,onChange:A=null,value:c=void 0,editable:m=!1,multi:u=!1,displayValues:R=!1,disabled:S,className:J,divRef:K,options:I,onSelect:L=null,onDeselect:w=null,...h},M)=>{var O;const[$,q]=j(!1),[l,v]=j(c),p=Y(void 0),x=Z(()=>G(d),[d]),y=F((e=!0)=>{S||q(e)});k(()=>{if($){const e=r=>{!(r.target instanceof Node)||!(p!=null&&p.current)||p.current&&p.current.contains(r.target)||p.current&&!p.current.contains(r.target)&&y(!1)};return document.addEventListener("click",e,!0),()=>document.removeEventListener("click",e,!0)}},[$,y]);const H=F((e,r)=>{var g;if(u){let E=!0;v(b=>b!=null&&b.includes(r)?(E=!1,b.filter(U=>U!==r)):(b||[]).concat(r));const C=(g=E?L:w)==null?void 0:g.call(void 0,r);typeof C=="function"&&C()}else v(r);u||y(!1)}),Q=e=>u?l?.includes(e):l===e;return k(()=>{v(c)},[c]),k(()=>{if(u&&c&&!Array.isArray(c))throw Error("Value must be an array if multi select is allowed.")},[u,c]),k(()=>{typeof A=="function"&&A(l)},[l]),_("div",{className:`form-group dropdown${s(o,"input--compressed")}${s($,"active")}${s(t,"form-group--inline")}${s(N,"form-group--error")}${s(S,"disabled")}${s(J)}`,ref:P([p,K]),children:[u?i(T,{className:"select editable",label:f,...h,placeholder:!Array.isArray(l)||!l.length?h.placeholder||a:"",readOnly:!m,onClick:()=>y(!0),onChange:()=>{},onChipRemove:e=>{let r;v(g=>(r=g[e],g.filter((E,C)=>C!==e))),typeof w=="function"&&w(r)},value:R?l:x.filter(e=>l?.includes(e.value)).map(e=>e.display),noInput:t&&!m&&Array.isArray(l)&&l.length>0,outerWrap:!1,ref:M}):_("div",{className:"form-group__text select editable",onClick:()=>y(!0),children:[i("input",{type:n,placeholder:h.placeholder||a,autoComplete:"off",readOnly:!m,...h,onChange:e=>{m&&(e.persist(),v(e.target.value))},value:m?l||"":R?l:((O=x?.find(e=>e.value===l))==null?void 0:O.display)||"",ref:M}),f?i("label",{htmlFor:h.id,children:f}):null]}),i("div",{className:"dropdown__menu",children:i(B,{handleOptionClick:H,isSelected:Q,children:I?I.map((e,r)=>i("option",{value:e.value,children:e.value},r)):d})}),N?i(ee,{text:N}):null]})});export{le as EditableSelect};
//# sourceMappingURL=index.js.map
