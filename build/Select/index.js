import t,{forwardRef as Q,useState as M,useRef as U,useMemo as X,useEffect as N,isValidElement as V}from"react";import B from"react-use-event-hook";import{useMergeRefs as Y}from"use-callback-ref";import{InputChips as Z}from"../InputChips/index.js";import{InputHelpBlock as P}from"../InputHelp/index.js";import{appendClass as c}from"../utils/index.js";function D(o){return o.type==="option"}function F(o){return o.type==="optgroup"}const W=({children:o,handleOptionClick:i,isSelected:a})=>t.Children.map(o,(n,p)=>V(n)?D(n)?t.createElement("a",{key:p,onClick:m=>i(m,n.props.value),className:`${c(a(n.props.value),"selected")}${c(n.props.disabled,"disabled")}`},n.props.children):F(n)?t.createElement("div",{key:p,className:"dropdown__group"},t.createElement("div",{className:"dropdown__group-header"},n.props.label),t.createElement(W,{handleOptionClick:i,isSelected:a},n.props.children)):n:n),q=o=>{const i=[];return t.Children.forEach(o,a=>{if(!V(a))return null;D(a)&&i.push({display:a.props.children,value:a.props.value}),F(a)&&i.push(q(a.props.children))}),i.flat()},T=Q(({compressed:o=!1,prompt:i="Select an option",inline:a=!1,type:n="text",children:p,label:m=null,error:b=null,onChange:_=null,value:u=void 0,editable:f=!1,multi:d=!1,displayValues:R=!1,disabled:O,className:z,divRef:L,options:S,onSelect:j=null,onDeselect:k=null,...v},x)=>{var I;const[w,G]=M(!1),[l,h]=M(u),s=U(void 0),$=X(()=>q(p),[p]),y=B((e=!0)=>{O||G(e)});N(()=>{if(w){const e=r=>{!(r.target instanceof Node)||!(s!=null&&s.current)||s.current&&s.current.contains(r.target)||s.current&&!s.current.contains(r.target)&&y(!1)};return document.addEventListener("click",e,!0),()=>document.removeEventListener("click",e,!0)}},[w,y]);const H=B((e,r)=>{var E;if(d){let A=!0;h(C=>C!=null&&C.includes(r)?(A=!1,C.filter(K=>K!==r)):(C||[]).concat(r));const g=(E=A?j:k)==null?void 0:E.call(void 0,r);typeof g=="function"&&g()}else h(r);d||y(!1)}),J=e=>d?l?.includes(e):l===e;return N(()=>{h(u)},[u]),N(()=>{if(d&&u&&!Array.isArray(u))throw Error("Value must be an array if multi select is allowed.")},[d,u]),N(()=>{typeof _=="function"&&_(l)},[l]),t.createElement("div",{className:`form-group dropdown${c(o,"input--compressed")}${c(w,"active")}${c(a,"form-group--inline")}${c(b,"form-group--error")}${c(O,"disabled")}${c(z)}`,ref:Y([s,L])},d?t.createElement(Z,{className:"select editable",label:m,...v,placeholder:!Array.isArray(l)||!l.length?v.placeholder||i:"",readOnly:!f,onClick:()=>y(!0),onChange:()=>{},onChipRemove:e=>{let r;h(E=>(r=E[e],E.filter((A,g)=>g!==e))),typeof k=="function"&&k(r)},value:R?l:$.filter(e=>l?.includes(e.value)).map(e=>e.display),noInput:a&&!f&&Array.isArray(l)&&l.length>0,outerWrap:!1,ref:x}):t.createElement("div",{className:"form-group__text select editable",onClick:()=>y(!0)},t.createElement("input",{type:n,placeholder:v.placeholder||i,autoComplete:"off",readOnly:!f,...v,onChange:e=>{f&&(e.persist(),h(e.target.value))},value:f?l||"":R?l:((I=$?.find(e=>e.value===l))==null?void 0:I.display)||"",ref:x}),m?t.createElement("label",{htmlFor:v.id},m):null),t.createElement("div",{className:"dropdown__menu"},t.createElement(W,{handleOptionClick:H,isSelected:J},S?S.map((e,r)=>t.createElement("option",{key:r,value:e.value},e.value)):p)),b?t.createElement(P,{text:b}):null)});export{T as EditableSelect};
//# sourceMappingURL=index.js.map
