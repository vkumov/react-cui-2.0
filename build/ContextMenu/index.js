import n,{useState as D,useRef as w,Children as R,isValidElement as C,useEffect as I,cloneElement as T}from"react";import{useFloatingTree as b,useFloatingNodeId as X,useFloatingParentNodeId as L,useFloating as Q,offset as U,flip as Y,shift as q,autoUpdate as A,useInteractions as Z,useRole as z,useDismiss as B,useListNavigation as H,useTypeahead as J,useMergeRefs as K,FloatingFocusManager as S,FloatingNode as V}from"@floating-ui/react";import W from"classnames";import{Transition as j}from"react-transition-group";import G from"react-use-event-hook";import{useFloatingContext as $,FloatingTreeWrapper as ee}from"../FloatingProvider/index.js";var _={submenu:"Dropdown-module_submenu__uXrqH",dropdown:"Dropdown-module_dropdown__QOREt",active:"Dropdown-module_active__p0UcD",appear:"Dropdown-module_appear__7ZQqu",dropdown_appear:"Dropdown-module_dropdown_appear__FJDEz",disappear:"Dropdown-module_disappear__9T3XQ",dropdown_disappear:"Dropdown-module_dropdown_disappear__3is4U",menu_root:"Dropdown-module_menu_root__in1ol",with_chevron:"Dropdown-module_with_chevron__ngan7"};const te=({contextMenuRef:r,onContextMenu:d,children:p})=>{const[i,l]=D(!1),[s,u]=D(null),x=w([]),M=w(R.map(p,e=>C(e)?e.props.label:null)),t=b(),v=X(),N=L(),{x:h,y:E,refs:c,strategy:k,context:a}=Q({open:i,onOpenChange:l,middleware:[U({mainAxis:5,alignmentAxis:4}),Y({padding:{bottom:50}}),q()],placement:"right-start",strategy:"fixed",whileElementsMounted:A,nodeId:v}),{getFloatingProps:y,getItemProps:P}=Z([z(a,{role:"menu"}),B(a,{bubbles:!1}),H(a,{listRef:x,activeIndex:s,nested:!1,onNavigate:u}),J(a,{listRef:M,onMatch:i?u:void 0,activeIndex:s})]),f=G(e=>{e.preventDefault();const o={x:e.clientX,y:e.clientY,width:0,height:0,top:e.clientY,right:e.clientX,bottom:e.clientY,left:e.clientX},m=()=>{c.setPositionReference({getBoundingClientRect(){return o}}),l(!0)};d?(async()=>await d(e)&&m())():m()});I(()=>{function e(){l(!1)}return t?.events.on("click",e),()=>{t?.events.off("click",e)}},[N,t,c]),I(()=>{if(!r.current)return;const e=r.current;return e.addEventListener("contextmenu",f),()=>{e.removeEventListener("contextmenu",f)}},[r,f]);const F=w(null),O=K([F,c.setFloating]);return n.createElement(j,{in:i,mountOnEnter:!0,unmountOnExit:!0,appear:!0,timeout:{enter:100,exit:250},nodeRef:F},e=>n.createElement(S,{context:a,initialFocus:c.floating},n.createElement(V,{id:v},n.createElement("div",{...y({className:W("dropdown",_.dropdown,{[_.disappear]:e==="exiting"||e==="exited",[_.appear]:e==="entering",[_.active]:e==="entered"}),ref:O,style:{position:k,top:E??0,left:h??0}})},n.createElement("div",{className:"dropdown__menu",style:{position:"unset"}},R.map(p,(o,m)=>C(o)&&T(o,P({tabIndex:-1,role:"menuitem",className:"menu_item",ref(g){x.current[m]=g},onClick(g){o.props.onClick?o.props.onClick(g):t?.events.emit("click")}}))))))))},ne=({children:r,contextMenuRef:d,onContextMenu:p,portalId:i})=>{const{root:l,id:s}=$({portalId:i,fallbackPortalId:"--cui-context-menu-portal"}),u=b();return n.createElement(ee,{withPortal:!u,portalRoot:l,portalId:s},n.createElement(te,{contextMenuRef:d,onContextMenu:p},r))};export{ne as ContextMenu};
//# sourceMappingURL=index.js.map
