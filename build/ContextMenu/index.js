function _arrayLikeToArray(arr,len){if(len==null||len>arr.length)len=arr.length;for(var i=0,arr2=new Array(len);i<len;i++)arr2[i]=arr[i];return arr2}function _arrayWithHoles(arr){if(Array.isArray(arr))return arr}function asyncGeneratorStep(gen,resolve,reject,_next,_throw,key,arg){try{var info=gen[key](arg);var value=info.value}catch(error){reject(error);return}if(info.done){resolve(value)}else{Promise.resolve(value).then(_next,_throw)}}function _asyncToGenerator(fn){return function(){var self=this,args=arguments;return new Promise(function(resolve,reject){var gen=fn.apply(self,args);function _next(value){asyncGeneratorStep(gen,resolve,reject,_next,_throw,"next",value)}function _throw(err){asyncGeneratorStep(gen,resolve,reject,_next,_throw,"throw",err)}_next(undefined)})}}function _defineProperty(obj,key,value){if(key in obj){Object.defineProperty(obj,key,{value:value,enumerable:true,configurable:true,writable:true})}else{obj[key]=value}return obj}function _iterableToArrayLimit(arr,i){var _i=arr==null?null:typeof Symbol!=="undefined"&&arr[Symbol.iterator]||arr["@@iterator"];if(_i==null)return;var _arr=[];var _n=true;var _d=false;var _s,_e;try{for(_i=_i.call(arr);!(_n=(_s=_i.next()).done);_n=true){_arr.push(_s.value);if(i&&_arr.length===i)break}}catch(err){_d=true;_e=err}finally{try{if(!_n&&_i["return"]!=null)_i["return"]()}finally{if(_d)throw _e}}return _arr}function _nonIterableRest(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function _slicedToArray(arr,i){return _arrayWithHoles(arr)||_iterableToArrayLimit(arr,i)||_unsupportedIterableToArray(arr,i)||_nonIterableRest()}function _unsupportedIterableToArray(o,minLen){if(!o)return;if(typeof o==="string")return _arrayLikeToArray(o,minLen);var n=Object.prototype.toString.call(o).slice(8,-1);if(n==="Object"&&o.constructor)n=o.constructor.name;if(n==="Map"||n==="Set")return Array.from(n);if(n==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return _arrayLikeToArray(o,minLen)}var __generator=this&&this.__generator||function(thisArg,body){var f,y,t,g,_={label:0,sent:function(){if(t[0]&1)throw t[1];return t[1]},trys:[],ops:[]};return g={next:verb(0),"throw":verb(1),"return":verb(2)},typeof Symbol==="function"&&(g[Symbol.iterator]=function(){return this}),g;function verb(n){return function(v){return step([n,v])}}function step(op){if(f)throw new TypeError("Generator is already executing.");while(_)try{if(f=1,y&&(t=op[0]&2?y["return"]:op[0]?y["throw"]||((t=y["return"])&&t.call(y),0):y.next)&&!(t=t.call(y,op[1])).done)return t;if(y=0,t)op=[op[0]&2,t.value];switch(op[0]){case 0:case 1:t=op;break;case 4:_.label++;return{value:op[1],done:false};case 5:_.label++;y=op[1];op=[0];continue;case 7:op=_.ops.pop();_.trys.pop();continue;default:if(!(t=_.trys,t=t.length>0&&t[t.length-1])&&(op[0]===6||op[0]===2)){_=0;continue}if(op[0]===3&&(!t||op[1]>t[0]&&op[1]<t[3])){_.label=op[1];break}if(op[0]===6&&_.label<t[1]){_.label=t[1];t=op;break}if(t&&_.label<t[2]){_.label=t[2];_.ops.push(op);break}if(t[2])_.ops.pop();_.trys.pop();continue}op=body.call(thisArg,_)}catch(e){op=[6,e];y=0}finally{f=t=0}if(op[0]&5)throw op[1];return{value:op[0]?op[1]:void 0,done:true}}};import React,{useState,useRef,Children,isValidElement,useCallback,useEffect,cloneElement}from"react";import{FloatingPortal,FloatingTree,useFloatingTree,useFloatingNodeId,useFloatingParentNodeId,useFloating,offset,flip,shift,autoUpdate,useInteractions,useRole,useDismiss,useClick,useListNavigation,useTypeahead,useMergeRefs,FloatingFocusManager,FloatingNode}from"@floating-ui/react";import cx from"classnames";import{Transition}from"react-transition-group";import{useFloatingContext}from"../FloatingProvider/index.js";var styles={"submenu":"Dropdown-module_submenu__uXrqH","dropdown":"Dropdown-module_dropdown__QOREt","active":"Dropdown-module_active__p0UcD","dropdown_appear":"Dropdown-module_dropdown_appear__FJDEz","disappear":"Dropdown-module_disappear__9T3XQ","dropdown_disappear":"Dropdown-module_dropdown_disappear__3is4U","menu_root":"Dropdown-module_menu_root__in1ol","with_chevron":"Dropdown-module_with_chevron__ngan7"};function _extends(){_extends=Object.assign||function(target){for(var i=1;i<arguments.length;i++){var source=arguments[i];for(var key in source){if(Object.prototype.hasOwnProperty.call(source,key)){target[key]=source[key]}}}return target};return _extends.apply(this,arguments)}var ContextMenuInner=function(param){var contextMenuRef=param.contextMenuRef,onContextMenu=param.onContextMenu,children=param.children;var ref=_slicedToArray(useState(false),2),open=ref[0],setOpen=ref[1];var ref1=_slicedToArray(useState(null),2),activeIndex=ref1[0],setActiveIndex=ref1[1];var listItemsRef=useRef([]);var listContentRef=useRef(Children.map(children,function(child){return isValidElement(child)?child.props.label:null}));var tree=useFloatingTree();var nodeId=useFloatingNodeId();var parentId=useFloatingParentNodeId();var ref2=useFloating({open:open,onOpenChange:setOpen,middleware:[offset({mainAxis:5,alignmentAxis:4}),flip({padding:{bottom:50}}),shift()],placement:"right-start",strategy:"fixed",whileElementsMounted:autoUpdate,nodeId:nodeId}),x=ref2.x,y=ref2.y,refs=ref2.refs,strategy=ref2.strategy,context=ref2.context;var ref3=useInteractions([useRole(context,{role:"menu"}),useDismiss(context),useClick(context,{event:"mousedown"}),useListNavigation(context,{listRef:listItemsRef,activeIndex:activeIndex,nested:false,onNavigate:setActiveIndex}),useTypeahead(context,{listRef:listContentRef,onMatch:open?setActiveIndex:undefined,activeIndex:activeIndex})]),getFloatingProps=ref3.getFloatingProps,getItemProps=ref3.getItemProps;var onRightClick=useCallback(function(e){e.preventDefault();var pos={x:e.clientX,y:e.clientY,width:0,height:0,top:e.clientY,right:e.clientX,bottom:e.clientY,left:e.clientX};var makePop=function(){refs.setPositionReference({getBoundingClientRect:function getBoundingClientRect(){return pos}});setOpen(true)};if(onContextMenu){var awaitResult=function(){var _ref=_asyncToGenerator(function(){return __generator(this,function(_state){switch(_state.label){case 0:return[4,onContextMenu(e)];case 1:if(_state.sent())makePop();return[2]}})});return function awaitResult(){return _ref.apply(this,arguments)}}();awaitResult()}else makePop()},[refs,onContextMenu]);useEffect(function(){var onTreeClick=function onTreeClick(){setOpen(false)};tree===null||tree===void 0?void 0:tree.events.on("click",onTreeClick);return function(){tree===null||tree===void 0?void 0:tree.events.off("click",onTreeClick)}},[parentId,tree,refs]);useEffect(function(){if(!contextMenuRef.current)return;var el=contextMenuRef.current;el.addEventListener("contextmenu",onRightClick);return function(){el.removeEventListener("contextmenu",onRightClick)}},[contextMenuRef,onRightClick]);var floatingNodeRef=useRef(null);var mergedFloatingRef=useMergeRefs([floatingNodeRef,refs.setFloating]);return React.createElement(Transition,{in:open,mountOnEnter:true,unmountOnExit:true,timeout:{enter:100,exit:250},nodeRef:floatingNodeRef},function(state){return React.createElement(FloatingFocusManager,{context:context,initialFocus:refs.floating},React.createElement(FloatingNode,{id:nodeId},React.createElement("div",_extends({},getFloatingProps({className:cx("dropdown",styles.active,styles.dropdown,_defineProperty({},styles.disappear,state==="exiting"||state==="exited")),ref:mergedFloatingRef,style:{position:strategy,top:y!==null&&y!==void 0?y:0,left:x!==null&&x!==void 0?x:0}})),React.createElement("div",{className:"dropdown__menu",style:{position:"unset"}},Children.map(children,function(child,index){return isValidElement(child)&&cloneElement(child,getItemProps({tabIndex:-1,role:"menuitem",className:"menu_item",ref:function ref(node){listItemsRef.current[index]=node},onClick:function onClick(e){if(child.props.onClick)child.props.onClick(e);else tree===null||tree===void 0?void 0:tree.events.emit("click")}}))})))))})};var ContextMenu=function(param){var children=param.children,contextMenuRef=param.contextMenuRef,onContextMenu=param.onContextMenu,portalId=param.portalId;var ref,ref1;var rootCtx=useFloatingContext();var portalRoot=(rootCtx===null||rootCtx===void 0?void 0:(ref=rootCtx.rootRef)===null||ref===void 0?void 0:ref.current)||undefined;portalId!==null&&portalId!==void 0?portalId:portalId=portalRoot?undefined:"--cui-context-menu-portal";return React.createElement(FloatingPortal,{root:(rootCtx===null||rootCtx===void 0?void 0:(ref1=rootCtx.rootRef)===null||ref1===void 0?void 0:ref1.current)||undefined,id:portalId},React.createElement(FloatingTree,null,React.createElement(ContextMenuInner,{contextMenuRef:contextMenuRef,onContextMenu:onContextMenu},children)))};export{ContextMenu};
//# sourceMappingURL=index.js.map
