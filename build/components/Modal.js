import e from"react";import t from"prop-types";import{_ as n,a as i,d as o,e as r,c as a}from"../tslib.es6-633881f1.js";import{a as l,e as s,E as c}from"../index-74b9c8d0.js";import{s as u}from"../style-inject.es-1f59c1d0.js";import{Button as d}from"./Button.js";import"formik";import{DisplayIf as p,ConditionalWrapper as m}from"./Conditional.js";import"./InputHelpBlock.js";import{Input as f}from"./Input.js";import E from"react-dom";import v from"react-modal";var h=!1,b="production"!==process.env.NODE_ENV?t.oneOfType([t.number,t.shape({enter:t.number,exit:t.number,appear:t.number}).isRequired]):null,x=("production"!==process.env.NODE_ENV&&t.oneOfType([t.string,t.shape({enter:t.string,exit:t.string,active:t.string}),t.shape({enter:t.string,enterDone:t.string,enterActive:t.string,exit:t.string,exitDone:t.string,exitActive:t.string})]),e.createContext(null)),y=function(t){var n,i;function o(e,n){var i;i=t.call(this,e,n)||this;var o,r=n&&!n.isMounting?e.enter:e.appear;return i.appearStatus=null,e.in?r?(o="exited",i.appearStatus="entering"):o="entered":o=e.unmountOnExit||e.mountOnEnter?"unmounted":"exited",i.state={status:o},i.nextCallback=null,i}i=t,(n=o).prototype=Object.create(i.prototype),n.prototype.constructor=n,n.__proto__=i,o.getDerivedStateFromProps=function(e,t){return e.in&&"unmounted"===t.status?{status:"exited"}:null};var r=o.prototype;return r.componentDidMount=function(){this.updateStatus(!0,this.appearStatus)},r.componentDidUpdate=function(e){var t=null;if(e!==this.props){var n=this.state.status;this.props.in?"entering"!==n&&"entered"!==n&&(t="entering"):"entering"!==n&&"entered"!==n||(t="exiting")}this.updateStatus(!1,t)},r.componentWillUnmount=function(){this.cancelNextCallback()},r.getTimeouts=function(){var e,t,n,i=this.props.timeout;return e=t=n=i,null!=i&&"number"!=typeof i&&(e=i.exit,t=i.enter,n=void 0!==i.appear?i.appear:t),{exit:e,enter:t,appear:n}},r.updateStatus=function(e,t){void 0===e&&(e=!1),null!==t?(this.cancelNextCallback(),"entering"===t?this.performEnter(e):this.performExit()):this.props.unmountOnExit&&"exited"===this.state.status&&this.setState({status:"unmounted"})},r.performEnter=function(e){var t=this,n=this.props.enter,i=this.context?this.context.isMounting:e,o=this.props.nodeRef?[i]:[E.findDOMNode(this),i],r=o[0],a=o[1],l=this.getTimeouts(),s=i?l.appear:l.enter;!e&&!n||h?this.safeSetState({status:"entered"},(function(){t.props.onEntered(r)})):(this.props.onEnter(r,a),this.safeSetState({status:"entering"},(function(){t.props.onEntering(r,a),t.onTransitionEnd(s,(function(){t.safeSetState({status:"entered"},(function(){t.props.onEntered(r,a)}))}))})))},r.performExit=function(){var e=this,t=this.props.exit,n=this.getTimeouts(),i=this.props.nodeRef?void 0:E.findDOMNode(this);t&&!h?(this.props.onExit(i),this.safeSetState({status:"exiting"},(function(){e.props.onExiting(i),e.onTransitionEnd(n.exit,(function(){e.safeSetState({status:"exited"},(function(){e.props.onExited(i)}))}))}))):this.safeSetState({status:"exited"},(function(){e.props.onExited(i)}))},r.cancelNextCallback=function(){null!==this.nextCallback&&(this.nextCallback.cancel(),this.nextCallback=null)},r.safeSetState=function(e,t){t=this.setNextCallback(t),this.setState(e,t)},r.setNextCallback=function(e){var t=this,n=!0;return this.nextCallback=function(i){n&&(n=!1,t.nextCallback=null,e(i))},this.nextCallback.cancel=function(){n=!1},this.nextCallback},r.onTransitionEnd=function(e,t){this.setNextCallback(t);var n=this.props.nodeRef?this.props.nodeRef.current:E.findDOMNode(this),i=null==e&&!this.props.addEndListener;if(n&&!i){if(this.props.addEndListener){var o=this.props.nodeRef?[this.nextCallback]:[n,this.nextCallback],r=o[0],a=o[1];this.props.addEndListener(r,a)}null!=e&&setTimeout(this.nextCallback,e)}else setTimeout(this.nextCallback,0)},r.render=function(){var t=this.state.status;if("unmounted"===t)return null;var n=this.props,i=n.children,o=(n.in,n.mountOnEnter,n.unmountOnExit,n.appear,n.enter,n.exit,n.timeout,n.addEndListener,n.onEnter,n.onEntering,n.onEntered,n.onExit,n.onExiting,n.onExited,n.nodeRef,function(e,t){if(null==e)return{};var n,i,o={},r=Object.keys(e);for(i=0;i<r.length;i++)n=r[i],t.indexOf(n)>=0||(o[n]=e[n]);return o}(n,["children","in","mountOnEnter","unmountOnExit","appear","enter","exit","timeout","addEndListener","onEnter","onEntering","onEntered","onExit","onExiting","onExited","nodeRef"]));return e.createElement(x.Provider,{value:null},"function"==typeof i?i(t,o):e.cloneElement(e.Children.only(i),o))},o}(e.Component);function g(){}y.contextType=x,y.propTypes="production"!==process.env.NODE_ENV?{nodeRef:t.shape({current:"undefined"==typeof Element?t.any:t.instanceOf(Element)}),children:t.oneOfType([t.func.isRequired,t.element.isRequired]).isRequired,in:t.bool,mountOnEnter:t.bool,unmountOnExit:t.bool,appear:t.bool,enter:t.bool,exit:t.bool,timeout:function(e){var t=b;e.addEndListener||(t=t.isRequired);for(var n=arguments.length,i=new Array(n>1?n-1:0),o=1;o<n;o++)i[o-1]=arguments[o];return t.apply(void 0,[e].concat(i))},addEndListener:t.func,onEnter:t.func,onEntering:t.func,onEntered:t.func,onExit:t.func,onExiting:t.func,onExited:t.func}:{},y.defaultProps={in:!1,mountOnEnter:!1,unmountOnExit:!1,appear:!1,enter:!0,exit:!0,onEnter:g,onEntering:g,onEntered:g,onExit:g,onExiting:g,onExited:g},y.UNMOUNTED="unmounted",y.EXITED="exited",y.ENTERING="entering",y.ENTERED="entered",y.EXITING="exiting";u("@-webkit-keyframes fade-out{0%{opacity:1}to{opacity:0}}@keyframes fade-out{0%{opacity:1}to{opacity:0}}.cui .modal-backdrop{background:rgba(196,199,204,.65);pointer-events:all;opacity:1;transition:opacity .15s linear;outline:none}.cui .ReactModal__Overlay--before-close .modal__dialog{-webkit-animation:blowdown .3s cubic-bezier(.165,.84,.44,1) forwards,fade-out .25s linear 1!important;animation:blowdown .3s cubic-bezier(.165,.84,.44,1) forwards,fade-out .25s linear 1!important}.cui .ReactModal__Overlay--before-close{opacity:0!important}body.cui .modal .modal__content div.modal__close>a{color:var(--cui-inactive-color)}body.cui .modal .modal__content div.modal__close>a:hover{color:var(--cui-active-color);text-decoration:none}");var C=function(t){var o=t.className,r=void 0===o?null:o,a=t.children,s=n(t,["className","children"]);return e.createElement("div",i({className:"modal__header"+l(r)},s),a)};C.propTypes={className:t.string,children:t.node.isRequired};var O=function(t){var o=t.className,r=void 0===o?null:o,a=t.children,s=n(t,["className","children"]);return e.createElement("div",i({className:"modal__body"+l(r)},s),a)};O.propTypes={className:t.string,children:t.node.isRequired};var k=function(t){var o=t.className,r=void 0===o?null:o,a=t.children,s=n(t,["className","children"]);return e.createElement("div",i({className:"modal__footer"+l(r)},s),a)};k.propTypes={className:t.string,children:t.node.isRequired};var T=function(t){var o=t.size,r=void 0===o?null:o,a=t.autoClose,s=void 0===a||a,c=t.animationDuration,u=void 0===c?250:c,d=t.closeIcon,f=void 0!==d&&d,E=t.title,h=void 0===E?null:E,b=t.closeHandle,x=void 0===b?null:b,g=t.left,O=void 0!==g&&g,k=t.transitionEvents,T=void 0===k?null:k,N=t.dialogProps,_=void 0===N?null:N,S=t.contentProps,q=void 0===S?null:S,R=t.maximize,w=void 0!==R&&R,D=t.children,H=t.isOpen,M=n(t,["size","autoClose","animationDuration","closeIcon","title","closeHandle","left","transitionEvents","dialogProps","contentProps","maximize","children","isOpen"]),L=e.useState(!1),z=L[0],I=L[1];e.useEffect((function(){return I(!1)}),[H]);var j=e.useMemo((function(){return z?"full":r}),[z,r]),P=e.useCallback((function(){I((function(e){return!e}))}),[]);return e.createElement(y,i({in:H,mountOnEnter:!0,unmountOnExit:!0,timeout:u},T),(function(t){return e.createElement(v,i({},M,{autoClose:s,onRequestClose:s&&x?x:void 0,overlayClassName:"modal-backdrop",isOpen:["entering","entered"].includes(t),className:"modal"+l(j,"modal--"+j)+l(O,"modal--left"),closeTimeoutMS:"object"==typeof u?u.exiting:u}),e.createElement("div",i({className:"modal__dialog"},_,{onClick:function(e){return e.stopPropagation()}}),e.createElement("div",i({className:"modal__content"},q),e.createElement(p,{condition:!(!f||!x)||w},e.createElement(m,{condition:!(!f||!x)&&w,wrapper:e.createElement("div",{className:"modal__close"})},e.createElement(p,{condition:w},e.createElement("a",{className:""+l(!(f&&x),"modal__close")+l(f&&x,"qtr-margin-right"),onClick:P},e.createElement("span",{className:z?"icon-minimize":"icon-maximize"}))),e.createElement(p,{condition:!(!f||!x)},e.createElement("a",{className:w?"":"modal__close",onClick:x},e.createElement("span",{className:"icon-close"}))))),e.createElement(p,{condition:!!h},e.createElement(C,null,e.createElement("h1",{className:"modal__title"},h))),D)))}))};T.propTypes={size:t.oneOf(["small","default","large","full","fluid"]),closeIcon:t.bool,closeHandle:t.func,title:t.string,isOpen:t.bool.isRequired,autoClose:t.bool,left:t.bool,animationDuration:t.oneOfType([t.number,t.exact({entering:t.number,exiting:t.number})]),children:t.node.isRequired,transitionEvents:t.objectOf(t.func),dialogProps:t.shape({}),contentProps:t.shape({}),maximize:t.bool},T.Small=function(t){return e.createElement(T,i({},t,{size:"small"}))},T.Large=function(t){return e.createElement(T,i({},t,{size:"large"}))},T.Full=function(t){return e.createElement(T,i({},t,{size:"full"}))},T.Fluid=function(t){return e.createElement(T,i({},t,{size:"fluid"}))},T.Header=C,T.Body=O,T.Footer=k;var N=function(t){var n=t.isOpen,i=void 0!==n&&n,a=t.confirmType,l=void 0===a?"primary":a,s=t.autoClose,c=void 0===s||s,u=t.confirmText,p=void 0===u?"Confirm":u,m=t.confirmHandle,f=t.closeHandle,E=t.prompt,v=e.useState(!1),h=v[0],b=v[1];return e.createElement(T,{isOpen:i,closeIcon:!0,closeHandle:f,autoClose:c,title:"Confirmation"},e.createElement(O,null,E),e.createElement(k,null,e.createElement(d.Light,{onClick:f},"Close"),e.createElement(d,{color:l,disabled:h,onClick:function(){return o(void 0,void 0,void 0,(function(){return r(this,(function(e){switch(e.label){case 0:return b(!0),[4,m()];case 1:return e.sent()&&b(!1),[2]}}))}))}},p,h?e.createElement("span",{className:"icon-animation spin qtr-margin-left"}):null)))};function _(t){var n=this,i=t.title,a=t.question,l=t.onSave,s=t.onClose,c=t.initial,u=t.type,m=t.isOpen,E=t.hint,v=t.validate,h=e.useState(c),b=h[0],x=h[1],y=e.useCallback((function(){return o(n,void 0,void 0,(function(){var e;return r(this,(function(t){switch(t.label){case 0:return(e="function"==typeof v)?[4,v(b)]:[3,2];case 1:e=!t.sent(),t.label=2;case 2:return e||(s(),l(b)),[2]}}))}))}),[s,l,b,v]);return e.useLayoutEffect((function(){return x(c)}),[c]),e.createElement(T,{isOpen:m,closeIcon:!0,closeHandle:s,title:i},e.createElement(O,null,e.createElement(f,{type:u,form:{errors:{},touched:{},values:{promptInput:b}},field:{onChange:function(e){return x(e.target.value)},name:"promptInput",value:b},label:e.createElement(e.Fragment,null,a,e.createElement(p,{condition:!!E&&"string"==typeof E},e.createElement("span",{"data-balloon":E,"data-balloon-length":"large","data-balloon-pos":"up"},e.createElement("span",{className:"icon-question-circle qtr-margin-left",style:{cursor:"help"}}))))})),e.createElement(k,null,e.createElement(d,{color:"light",onClick:s},"Close"),e.createElement(d,{color:"primary",onClick:y},"OK")))}N.propTypes={isOpen:t.bool,confirmHandle:t.func.isRequired,closeHandle:t.func.isRequired,prompt:t.node.isRequired,confirmText:t.string,autoClose:t.bool},_.propTypes={title:t.node.isRequired,question:t.node.isRequired,onSave:t.func.isRequired,onClose:t.func,initial:t.oneOfType([t.string,t.number]),type:t.string,isOpen:t.bool.isRequired,hint:t.node,validate:t.func},_.defaultProps={onClose:null,initial:null,type:"text",hint:null,validate:null};var S=function(){var t=e.useState([]),n=t[0],l=t[1],u=e.useCallback((function(e){return l((function(t){return a(t,[i({id:Date.now(),shown:!0},e)])}))}),[]),p=e.useCallback((function(e){l((function(t){return t.map((function(t){return t.id===e?i(i({},t),{shown:!1}):t}))}))}),[]),m=e.useCallback((function(e){l((function(t){return t.filter((function(t){return t.id!==e}))}))}),[]),f=e.useCallback((function(e){p(e),setTimeout((function(){return m(e)}),500)}),[p,m]);return e.useEffect((function(){s.on(c.SHOW_MODAL,(function(e){return u(e)}))}),[u]),n.length?e.createElement(e.Fragment,null,n.map((function(t){if("notification"===t.modalType)return e.createElement(T,{key:t.id,isOpen:t.shown,closeIcon:!0,closeHandle:function(){return f(t.id)},title:t.title},e.createElement(O,null,t.body),e.createElement(k,null,e.createElement(d,{color:t.buttonColor||"light",onClick:function(){return f(t.id)}},t.button)));if("prompt"===t.modalType){if(void 0!==t.options){var n=t.options,i=n.initial,a=void 0===i?"":i,l=n.type,s=void 0===l?"text":l,c=n.hint,u=void 0===c?void 0:c,p=n.validate,m=void 0===p?void 0:p;return e.createElement(_,{key:t.id,isOpen:t.shown,onClose:function(){return f(t.id)},onSave:t.cb,title:t.title,question:t.question,initial:a,type:s,hint:u,validate:m})}return e.createElement(_,{key:t.id,isOpen:t.shown,onClose:function(){return f(t.id)},onSave:t.cb,title:t.title,question:t.question,initial:t.initial,type:t.type,hint:t.hint})}return"confirmation"===t.modalType?e.createElement(N,{key:t.id,isOpen:t.shown,prompt:t.prompt,confirmHandle:function(){return o(void 0,void 0,void 0,(function(){return r(this,(function(e){switch(e.label){case 0:return[4,t.onConfirm()];case 1:return e.sent()&&f(t.id),[2,!0]}}))}))},closeHandle:function(){return f(t.id)},confirmText:t.confirmText,confirmType:t.confirmType}):null}))):null},q=function(t,n,i,o){if(void 0===i&&(i="primary"),void 0===o&&(o="Confirm"),!t)throw new Error("Prompt must be specified");if(!n||"function"!=typeof n)throw new Error("onConfirm must be specified and must be a function");s.emit(c.SHOW_MODAL,{modalType:"confirmation",prompt:e.createElement("p",null,t),onConfirm:n,confirmText:o,confirmType:i})},R=function(e,t,n,i){if(void 0===n&&(n="light"),void 0===i&&(i="OK"),!e||!t)throw new Error("Title and body must be specified");s.emit(c.SHOW_MODAL,{modalType:"notification",title:e,body:t,buttonColor:n,button:i})},w=function(e,t,n,i,o,r){if(void 0===i&&(i=""),void 0===o&&(o="text"),void 0===r&&(r=void 0),!e||!t)throw new Error("Title and question must be specified");"object"!=typeof i?s.emit(c.SHOW_MODAL,{modalType:"prompt",title:e,initial:i,type:o,question:t,cb:n,hint:r}):s.emit(c.SHOW_MODAL,{modalType:"prompt",title:e,question:t,cb:n,options:i})};export{S as ConfirmationListener,N as ConfirmationModal,S as DynamicModal,T as Modal,O as ModalBody,k as ModalFooter,C as ModalHeader,_ as PromptModal,q as confirmation,R as notification,R as notificationModal,w as prompt};
