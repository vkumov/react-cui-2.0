import{_ as e,a as n}from"../../tslib.es6-a57c95d4.js";import t,{useState as r,forwardRef as o,useRef as l,useMemo as i,useCallback as a,useEffect as c,isValidElement as u}from"react";import{InputChips as d}from"../InputChips/index.js";import{InputHelpBlock as p}from"../InputHelpBlock.js";import{a as s}from"../../index-fb409a55.js";import"../Conditional.js";import"../Label/index.js";import"../InputHelpBaloon.js";import"../../style-inject.es-1f59c1d0.js";function f(e,n){return t=n,o=function(n){return e.forEach((function(e){return function(e,n){return"function"==typeof e?e(n):e&&(e.current=n),e}(e,n)}))},(l=r((function(){return{value:t,callback:o,facade:{get current(){return l.value},set current(e){var n=l.value;n!==e&&(l.value=e,l.callback(e,n))}}}}))[0]).callback=o,l.facade;var t,o,l}function v(e){return"option"===e.type}function m(e){return"optgroup"===e.type}var h=function(e){var n=e.children,r=e.handleOptionClick,o=e.isSelected;return t.Children.map(n,(function(e,n){return u(e)?v(e)?t.createElement("a",{key:n,onClick:function(n){return r(n,e.props.value)},className:"".concat(s(o(e.props.value),"selected")).concat(s(e.props.disabled,"disabled"))},e.props.children):m(e)?t.createElement("div",{key:n,className:"dropdown__group"},t.createElement("div",{className:"dropdown__group-header"},e.props.label),t.createElement(h,{handleOptionClick:r,isSelected:o},e.props.children)):e:e}))},y=function(e){var n=[];return t.Children.forEach(e,(function(e){if(!u(e))return null;v(e)&&n.push({display:e.props.children,value:e.props.value}),m(e)&&n.push(y(e.props.children))})),n.flat()},b=o((function(o,u){var v,m=o.compressed,b=void 0!==m&&m,g=o.prompt,E=void 0===g?"Select an option":g,C=o.inline,k=void 0!==C&&C,N=o.type,j=void 0===N?"text":N,_=o.children,x=o.label,w=void 0===x?null:x,A=o.error,S=void 0===A?null:A,O=o.onChange,I=void 0===O?null:O,L=o.value,R=void 0===L?void 0:L,V=o.editable,B=void 0!==V&&V,D=o.multi,H=void 0!==D&&D,F=o.displayValues,W=void 0!==F&&F,q=o.disabled,z=o.className,G=o.divRef,J=o.options,K=o.onSelect,M=void 0===K?null:K,P=o.onDeselect,Q=void 0===P?null:P,T=e(o,["compressed","prompt","inline","type","children","label","error","onChange","value","editable","multi","displayValues","disabled","className","divRef","options","onSelect","onDeselect"]),U=r(!1),X=U[0],Y=U[1],Z=r(R),$=Z[0],ee=Z[1],ne=l(void 0),te=i((function(){return y(_)}),[_]),re=a((function(e){void 0===e&&(e=!0),q||Y(e)}),[q]);c((function(){if(X){var e=function(e){e.target instanceof Node&&(null==ne?void 0:ne.current)&&(ne.current&&ne.current.contains(e.target)||ne.current&&!ne.current.contains(e.target)&&re(!1))};return document.addEventListener("click",e,!0),function(){return document.removeEventListener("click",e,!0)}}}),[X,re]);var oe=a((function(e,n){var t;if(H){var r=!0;ee((function(e){return(null==e?void 0:e.includes(n))?(r=!1,e.filter((function(e){return e!==n}))):(e||[]).concat(n)}));var o=null===(t=r?M:Q)||void 0===t?void 0:t.call(void 0,n);"function"==typeof o&&o()}else ee(n);H||re(!1)}),[re,H,M,Q]);return c((function(){ee(R)}),[R]),c((function(){if(H&&R&&!Array.isArray(R))throw Error("Value must be an array if multi select is allowed.")}),[H,R]),c((function(){"function"==typeof I&&I($)}),[$]),t.createElement("div",{className:"form-group dropdown".concat(s(b,"input--compressed")).concat(s(X,"active")).concat(s(k,"form-group--inline")).concat(s(S,"form-group--error")).concat(s(q,"disabled")).concat(s(z)),ref:f([ne,G])},H?t.createElement(d,n({className:"select editable",label:w},T,{placeholder:Array.isArray($)&&$.length?"":T.placeholder||E,readOnly:!B,onClick:function(){return re(!0)},onChange:function(){},onChipRemove:function(e){var n;ee((function(t){return n=t[e],t.filter((function(n,t){return t!==e}))})),"function"==typeof Q&&Q(n)},value:W?$:te.filter((function(e){return null==$?void 0:$.includes(e.value)})).map((function(e){return e.display})),noInput:k&&!B&&Array.isArray($)&&$.length>0,outerWrap:!1,ref:u})):t.createElement("div",{className:"form-group__text select editable",onClick:function(){return re(!0)}},t.createElement("input",n({type:j,placeholder:T.placeholder||E,autoComplete:"off",readOnly:!B},T,{onChange:function(e){B&&(e.persist(),ee(e.target.value))},value:B?$||"":W?$:(null===(v=null==te?void 0:te.find((function(e){return e.value===$})))||void 0===v?void 0:v.display)||"",ref:u})),w?t.createElement("label",{htmlFor:T.id},w):null),t.createElement("div",{className:"dropdown__menu"},t.createElement(h,{handleOptionClick:oe,isSelected:function(e){return H?null==$?void 0:$.includes(e):$===e}},J?J.map((function(e,n){return t.createElement("option",{key:n,value:e.value},e.value)})):_)),S?t.createElement(p,{text:S}):null)}));export{b as EditableSelect};
