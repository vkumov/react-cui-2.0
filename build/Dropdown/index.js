import n,{forwardRef as g,isValidElement as v,useState as x,useEffect as b,useRef as C,Children as Q,cloneElement as W}from"react";import{useFloatingTree as ae,useFloatingNodeId as le,useFloatingParentNodeId as se,useFloating as ie,offset as me,flip as pe,shift as de,size as ue,autoUpdate as ce,useInteractions as fe,useHover as we,safePolygon as _e,useClick as ge,useRole as ve,useDismiss as Ee,useListNavigation as Ne,useTypeahead as he,useMergeRefs as ye,FloatingNode as De,FloatingOverlay as ke,FloatingFocusManager as xe}from"@floating-ui/react";import m from"classnames";import{Transition as be}from"react-transition-group";import{useFloatingContext as Ce,FloatingTreeWrapper as Fe}from"../FloatingProvider/index.js";import{useCustomDismiss as Ie}from"../hooks/useCustomDismiss.js";var p={submenu:"Dropdown-module_submenu__uXrqH",dropdown:"Dropdown-module_dropdown__QOREt",active:"Dropdown-module_active__p0UcD",appear:"Dropdown-module_appear__7ZQqu",dropdown_appear:"Dropdown-module_dropdown_appear__FJDEz",disappear:"Dropdown-module_disappear__9T3XQ",dropdown_disappear:"Dropdown-module_dropdown_disappear__3is4U",menu_root:"Dropdown-module_menu_root__in1ol",with_chevron:"Dropdown-module_with_chevron__ngan7"};const F=g(({selected:s,className:t,icon:a,children:l,submenu:c,...w},E)=>n.createElement("a",{ref:E,...w,className:m(t,{selected:s&&!c,[p.submenu]:c})},a?v(a)?n.createElement(n.Fragment,null,a,v(l)?l:n.createElement("span",{className:"qtr-margin-left"},l)):n.createElement(n.Fragment,null,n.createElement("span",{className:a}),n.createElement("span",{className:"qtr-margin-left"},l)):l));F.displayName="MenuElement";const I=g(({children:s,label:t,noChevron:a,placement:l,strategy:c,alwaysClose:w,onOpen:E,onClose:M,isOpen:_,nested:r,withSizeLimit:j,portalId:B,portalRoot:G,...R},J)=>{const[u,f]=x(_??!1),[P,h]=x(null),[y,T]=x(!1);b(()=>{typeof _<"u"&&f(_)},[_]);const O=C([]),V=C(Q.map(s,e=>v(e)?e.props.label:null)),i=ae(),A=le(),D=se();r!=null||(r=D!=null);const{root:Z,id:Y}=Ce({root:G,portalId:B,fallbackPortalId:"--cui-dropdown-portal"}),{x:L,y:K,reference:ee,floating:ne,strategy:oe,refs:U,context:d}=ie({open:u,onOpenChange:e=>{typeof E=="function"&&e&&E(),typeof M=="function"&&!e&&M(),f(e)},middleware:[me({mainAxis:r?0:2,alignmentAxis:r?-5:0}),pe(),de(),j?ue({apply({availableHeight:e,availableWidth:o,elements:N}){Object.assign(N.floating.style,{maxWidth:`${o}px`,maxHeight:`${e-4}px`})}}):void 0].filter(Boolean),placement:r?"right-start":l,nodeId:A,whileElementsMounted:ce,strategy:c}),{getReferenceProps:q,getFloatingProps:te,getItemProps:re}=fe([we(d,{handleClose:_e({restMs:25}),enabled:r&&y,delay:{open:75}}),ge(d,{toggle:!r,event:"mousedown",ignoreMouse:r}),ve(d,{role:"menu"}),Ee(d,{bubbles:!0,outsidePress:!0,escapeKey:!1}),Ie(d),Ne(d,{listRef:O,activeIndex:P,nested:r,onNavigate:h}),he(d,{listRef:V,onMatch:u?h:void 0,activeIndex:P})]);b(()=>{function e(){var o;w&&f(!1),D===null&&((o=U.domReference.current)==null||o.focus())}return i?.events.on("click",e),()=>{i?.events.off("click",e)}},[D,i,U,w]),b(()=>{function e(){T(!0)}function o(){T(!1)}return window.addEventListener("pointermove",e,{once:!0,capture:!0}),window.addEventListener("keydown",o,!0),()=>{window.removeEventListener("pointermove",e,{capture:!0}),window.removeEventListener("keydown",o,!0)}},[y]);const z=C(null),H=ye([J,ee]);return n.createElement(De,{id:A},v(t)?W(t,{...q({...R,ref:H,onClick(e){e.stopPropagation(),e.currentTarget.focus()},...r?{className:m("menu_item",t.props.className,{open:u}),role:"menuitem",onKeyDown(e){(e.key==="ArrowUp"||e.key==="ArrowDown")&&f(!1)}}:{className:m(p.menu_root,t.props.className,{open:u,[p.with_chevron]:!a})}})}):n.createElement(F,{submenu:r,...q({...R,ref:H,onClick(e){e.stopPropagation(),e.currentTarget.focus()},...r?{className:m("menu_item",{open:u}),role:"menuitem",onKeyDown(e){(e.key==="ArrowUp"||e.key==="ArrowDown")&&f(!1)}}:{className:m(p.menu_root,{open:u,[p.with_chevron]:!a})}})},t),n.createElement(Fe,{withPortal:!i,portalId:Y,portalRoot:Z},n.createElement(be,{in:u,mountOnEnter:!0,unmountOnExit:!0,appear:!0,timeout:{enter:100,exit:250},nodeRef:z},e=>n.createElement(ke,{style:{zIndex:50}},n.createElement(xe,{context:d,modal:!r,returnFocus:!r,order:["reference","content"]},n.createElement("div",{...te({className:m("dropdown",p.dropdown,{[p.disappear]:e==="exiting"||e==="exited",[p.appear]:e==="entering",[p.active]:e==="entered"}),ref(o){z.current=o,ne(o)},style:{position:oe,top:K??0,left:L??0},onKeyDown(o){o.key==="Tab"&&f(!1)}})},n.createElement("div",{className:"dropdown__menu",onClick:w?()=>{i?.events.emit("click")}:void 0},Q.map(s,(o,N)=>v(o)&&W(o,re({tabIndex:-1,role:"menuitem",className:m("menu_item",o.props.className),ref(k){O.current[N]=k},onClick(k){o.props.onClick?o.props.onClick(k):i?.events.emit("click")},onPointerEnter(){y&&h(N)}}))))))))))});I.displayName="Menu";const S=g(({children:s,placement:t="bottom-start",...a},l)=>n.createElement(I,{placement:t,...a,nested:!1,ref:l},s));S.displayName="Dropdown";const X=g(({className:s,...t},a)=>n.createElement("div",{...t,className:m("divider",s),ref:a}));X.displayName="MenuDivider";const $=g(({className:s,header:t,children:a,...l},c)=>n.createElement("div",{className:m("dropdown__group",s),...l,ref:c},t?n.createElement("div",{className:"dropdown__group-header"},t):null,a));$.displayName="MenuGroup";export{S as Dropdown,I as Menu,X as MenuDivider,F as MenuElement,$ as MenuGroup};
//# sourceMappingURL=index.js.map
