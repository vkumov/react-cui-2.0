import{jsx as r,jsxs as y,Fragment as C}from"react/jsx-runtime";import{forwardRef as _,isValidElement as v,useState as b,useEffect as E,useRef as F,Children as W,cloneElement as j}from"react";import{useFloatingTree as X,useFloatingNodeId as pe,useFloatingParentNodeId as ce,useFloating as me,offset as ue,flip as fe,shift as we,size as he,autoUpdate as _e,useInteractions as ve,useHover as ge,safePolygon as Ne,useClick as ye,useRole as xe,useDismiss as ke,useListNavigation as De,useTypeahead as Ce,useMergeRefs as be,FloatingNode as Ee,FloatingOverlay as Fe,FloatingFocusManager as Ie}from"@floating-ui/react";import s from"classnames";import{Transition as Me}from"react-transition-group";import Re from"react-use-event-hook";import{useFloatingContext as Pe,FloatingTreeWrapper as Te}from"../FloatingProvider/index.js";import{useCustomDismiss as Oe}from"../hooks/useCustomDismiss.js";var d={submenu:"Dropdown-module_submenu__uXrqH",dropdown:"Dropdown-module_dropdown__QOREt",active:"Dropdown-module_active__p0UcD",appear:"Dropdown-module_appear__7ZQqu",dropdown_appear:"Dropdown-module_dropdown_appear__FJDEz",disappear:"Dropdown-module_disappear__9T3XQ",dropdown_disappear:"Dropdown-module_dropdown_disappear__3is4U",menu_root:"Dropdown-module_menu_root__in1ol",with_chevron:"Dropdown-module_with_chevron__ngan7"};const I=_(({selected:i,className:n,icon:o,children:t,submenu:u,...w},g)=>r("a",{ref:g,...w,className:s(n,{selected:i&&!u,[d.submenu]:u}),children:o?v(o)?y(C,{children:[o,v(t)?t:r("span",{className:"qtr-margin-left",children:t})]}):y(C,{children:[r("span",{className:o}),r("span",{className:"qtr-margin-left",children:t})]}):t}));I.displayName="MenuElement";const Ae=({onClick:i,children:n})=>{const o=X();return E(()=>{const t=o;return t?.events.on("click",i),()=>{t?.events.off("click",i)}},[o,i]),r(C,{children:n})},M=_(({children:i,label:n,noChevron:o,placement:t,strategy:u,alwaysClose:w,onOpen:g,onClose:R,isOpen:h,nested:a,withSizeLimit:S,portalId:Z,portalRoot:$,icon:V,...P},Y)=>{const[c,m]=b(h??!1),[T,x]=b(null),[k,O]=b(!1);E(()=>{typeof h<"u"&&m(h)},[h]);const A=F([]),ee=F(W.map(i,e=>v(e)?e.props.label:null)),f=X(),z=pe(),L=ce();a!=null||(a=L!=null);const{root:ne,id:oe}=Pe({root:$,portalId:Z,fallbackPortalId:"--cui-dropdown-portal"}),{x:H,y:K,reference:te,floating:re,strategy:ae,refs:le,context:p}=me({open:c,onOpenChange:e=>{typeof g=="function"&&e&&g(),typeof R=="function"&&!e&&R(),m(e)},middleware:[ue({mainAxis:a?0:2,alignmentAxis:a?-5:0}),fe(),we(),S?he({apply({availableHeight:e,availableWidth:l,elements:N}){Object.assign(N.floating.style,{maxWidth:`${l}px`,maxHeight:`${e-4}px`})}}):void 0].filter(Boolean),placement:a?"right-start":t,nodeId:z,whileElementsMounted:_e,strategy:u}),{getReferenceProps:U,getFloatingProps:ie,getItemProps:se}=ve([ge(p,{handleClose:Ne({restMs:25}),enabled:a&&k,delay:{open:75}}),ye(p,{toggle:!a,event:"mousedown",ignoreMouse:a}),xe(p,{role:"menu"}),ke(p,{bubbles:!0,outsidePress:!0,escapeKey:!1}),Oe(p),De(p,{listRef:A,activeIndex:T,nested:a,onNavigate:x}),Ce(p,{listRef:ee,onMatch:c?x:void 0,activeIndex:T})]),de=Re(()=>{var e;w&&m(!1),L===null&&((e=le.domReference.current)==null||e.focus())});E(()=>{function e(){O(!0)}function l(){O(!1)}return window.addEventListener("pointermove",e,{once:!0,capture:!0}),window.addEventListener("keydown",l,!0),()=>{window.removeEventListener("pointermove",e,{capture:!0}),window.removeEventListener("keydown",l,!0)}},[k]);const q=F(null),Q=be([Y,te]);return y(Ee,{id:z,children:[v(n)?j(n,{...U({...P,ref:Q,onClick(e){e.stopPropagation(),e.currentTarget.focus()},...a?{className:s("menu_item",n.props.className,{open:c}),role:"menuitem",onKeyDown(e){(e.key==="ArrowUp"||e.key==="ArrowDown")&&m(!1)}}:{className:s(d.menu_root,n.props.className,{open:c,[d.with_chevron]:!o})}})}):r(I,{submenu:a,icon:V,...U({...P,ref:Q,onClick(e){e.stopPropagation(),e.currentTarget.focus()},...a?{className:s("menu_item",{open:c}),role:"menuitem",onKeyDown(e){(e.key==="ArrowUp"||e.key==="ArrowDown")&&m(!1)}}:{className:s(d.menu_root,{open:c,[d.with_chevron]:!o})}}),children:n}),r(Te,{withPortal:!f,portalId:oe,portalRoot:ne,children:r(Ae,{onClick:de,children:r(Me,{in:c,mountOnEnter:!0,unmountOnExit:!0,appear:!0,timeout:{enter:100,exit:250},nodeRef:q,children:e=>r(Fe,{style:{zIndex:a?50:"calc(var(--cui-max-zindex, 1000) + 2)"},children:r(Ie,{context:p,modal:!a,returnFocus:!a,order:["reference","content"],children:r("div",{...ie({className:s("dropdown",d.dropdown,{[d.disappear]:e==="exiting"||e==="exited",[d.appear]:e==="entering",[d.active]:e==="entered"}),ref(l){q.current=l,re(l)},style:{position:ae,top:K??0,left:H??0},onKeyDown(l){l.key==="Tab"&&m(!1)}}),children:r("div",{className:"dropdown__menu",onClick:w?()=>{f?.events.emit("click")}:void 0,children:W.map(i,(l,N)=>v(l)&&j(l,se({tabIndex:-1,role:"menuitem",className:s("menu_item",l.props.className),ref(D){A.current[N]=D},onClick(D){l.props.onClick&&l.props.onClick(D),f?f?.events.emit("click"):w&&m(!1)},onPointerEnter(){k&&x(N)}})))})})})})})})})]})});M.displayName="Menu";const B=_(({children:i,placement:n="bottom-start",...o},t)=>r(M,{placement:n,...o,nested:!1,ref:t,children:i}));B.displayName="Dropdown";const G=_(({className:i,...n},o)=>r("div",{...n,className:s("divider",i),ref:o}));G.displayName="MenuDivider";const J=_(({className:i,header:n,children:o,...t},u)=>y("div",{className:s("dropdown__group",i),...t,ref:u,children:[n?r("div",{className:"dropdown__group-header",children:n}):null,o]}));J.displayName="MenuGroup";export{B as Dropdown,M as Menu,G as MenuDivider,I as MenuElement,J as MenuGroup};
//# sourceMappingURL=index.js.map
