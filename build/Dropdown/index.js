import{jsx as n,jsxs as x,Fragment as D}from"react/jsx-runtime";import{forwardRef as _,isValidElement as h,useState as C,useEffect as k,useRef as I,Children as W,cloneElement as j}from"react";import{useFloatingTree as X,useFloatingNodeId as me,useFloatingParentNodeId as ue,useFloating as we,offset as fe,flip as _e,shift as he,size as ge,autoUpdate as ve,useInteractions as ye,useHover as Ne,safePolygon as xe,useClick as De,useRole as ke,useDismiss as be,useListNavigation as Ee,useTypeahead as Fe,useMergeRefs as B,FloatingNode as Ce,FloatingOverlay as Ie,FloatingFocusManager as Me}from"@floating-ui/react";import s from"classnames";import{Transition as Re}from"react-transition-group";import Pe from"react-use-event-hook";import{useFloatingContext as Le,FloatingTreeWrapper as Oe}from"../FloatingProvider/index.js";import{useCustomDismiss as Te}from"../hooks/useCustomDismiss.js";var d={submenu:"Dropdown-module_submenu__uXrqH",dropdown:"Dropdown-module_dropdown__QOREt",active:"Dropdown-module_active__p0UcD",appear:"Dropdown-module_appear__7ZQqu",dropdown_appear:"Dropdown-module_dropdown_appear__FJDEz",disappear:"Dropdown-module_disappear__9T3XQ",dropdown_disappear:"Dropdown-module_dropdown_disappear__3is4U",menu_root:"Dropdown-module_menu_root__in1ol",with_chevron:"Dropdown-module_with_chevron__ngan7"};const M=_(({selected:l,className:o,icon:r,children:t,submenu:m,...g},v)=>n("a",{ref:v,...g,className:s(o,{selected:l&&!m,[d.submenu]:m}),children:r?h(r)?x(D,{children:[r,h(t)?t:n("span",{className:"qtr-margin-left",children:t})]}):x(D,{children:[n("span",{className:r}),n("span",{className:"qtr-margin-left",children:t})]}):t}));M.displayName="MenuElement";const Ae=({onClick:l,children:o})=>{const r=X();return k(()=>{const t=r;return t?.events.on("click",l),()=>{t?.events.off("click",l)}},[r,l]),n(D,{children:o})},R=_(({children:l,label:o,noChevron:r,placement:t,strategy:m,alwaysClose:g,onOpen:v,onClose:P,isOpen:f,nested:i,withSizeLimit:$,portalId:J,portalRoot:V,icon:Y,...L},ee)=>{const[p,u]=C(f??!1),[O,b]=C(null),[E,T]=C(!1);k(()=>{typeof f<"u"&&u(f)},[f]);const A=I([]),ne=I(W.map(l,e=>h(e)?e.props.label:null)),w=X(),z=me(),H=ue();i!=null||(i=H!=null);const{root:oe,id:re}=Le({root:V,portalId:J,fallbackPortalId:"--cui-dropdown-portal"}),{x:K,y:U,reference:te,floating:ie,strategy:le,refs:ae,context:c}=we({open:p,onOpenChange:e=>{typeof v=="function"&&e&&v(),typeof P=="function"&&!e&&P(),u(e)},middleware:[fe({mainAxis:i?0:2,alignmentAxis:i?-5:0}),_e(),he(),$?ge({apply({availableHeight:e,availableWidth:a,elements:N}){Object.assign(N.floating.style,{maxWidth:`${a}px`,maxHeight:`${e-4}px`})}}):void 0].filter(Boolean),placement:i?"right-start":t,nodeId:z,whileElementsMounted:ve,strategy:m}),{getReferenceProps:q,getFloatingProps:se,getItemProps:de}=ye([Ne(c,{handleClose:xe({restMs:25}),enabled:i&&E,delay:{open:75}}),De(c,{toggle:!i,event:"mousedown",ignoreMouse:i}),ke(c,{role:"menu"}),be(c,{bubbles:!0,outsidePress:!0,escapeKey:!1}),Te(c),Ee(c,{listRef:A,activeIndex:O,nested:i,onNavigate:b}),Fe(c,{listRef:ne,onMatch:p?b:void 0,activeIndex:O})]),F=Pe(()=>{var e;g&&u(!1),H===null&&((e=ae.domReference.current)==null||e.focus())});k(()=>{function e(){T(!0)}function a(){T(!1)}return window.addEventListener("pointermove",e,{once:!0,capture:!0}),window.addEventListener("keydown",a,!0),()=>{window.removeEventListener("pointermove",e,{capture:!0}),window.removeEventListener("keydown",a,!0)}},[E]);const y=I(null),ce=B([y,ie]),Q=B([ee,te]);return k(()=>{const e=a=>{y.current&&y.current.contains(a.target)&&(w?w.events.emit("click"):F())};return document.addEventListener("click",e),()=>{document.removeEventListener("click",e)}},[w,F]),x(D,{children:[h(o)?j(o,{...q({...L,ref:Q,onClick(e){e.stopPropagation(),e.currentTarget.focus()},...i?{className:s("menu_item",o.props.className,{open:p}),role:"menuitem",onKeyDown(e){(e.key==="ArrowUp"||e.key==="ArrowDown")&&u(!1)}}:{className:s(d.menu_root,o.props.className,{open:p,[d.with_chevron]:!r})}})}):n(M,{submenu:i,icon:Y,...q({...L,ref:Q,onClick(e){e.stopPropagation(),e.currentTarget.focus()},...i?{className:s("menu_item",{open:p}),role:"menuitem",onKeyDown(e){(e.key==="ArrowUp"||e.key==="ArrowDown")&&u(!1)}}:{className:s(d.menu_root,{open:p,[d.with_chevron]:!r})}}),children:o}),n(Re,{in:p,mountOnEnter:!0,unmountOnExit:!0,appear:!0,timeout:{enter:100,exit:250},nodeRef:y,children:e=>n(Oe,{withPortal:!w,portalId:re,portalRoot:oe,children:n(Ce,{id:z,children:n(Ae,{onClick:F,children:n(Ie,{style:{zIndex:i?50:"calc(var(--cui-max-zindex, 1000) + 2)"},children:n(Me,{context:c,modal:!i,returnFocus:!i,order:["reference","content"],children:n("div",{...se({className:s("dropdown",d.dropdown,{[d.disappear]:e==="exiting"||e==="exited",[d.appear]:e==="entering",[d.active]:e==="entered"}),ref:ce,style:{position:le,top:U??0,left:K??0},onKeyDown(a){a.key==="Tab"&&u(!1)}}),children:n("div",{className:"dropdown__menu",onClick:g?()=>{w?.events.emit("click")}:void 0,children:W.map(l,(a,N)=>h(a)&&j(a,de({...a.props,tabIndex:-1,role:"menuitem",className:s("menu_item",a.props.className),ref(pe){A.current[N]=pe},onPointerEnter(){E&&b(N)}})))})})})})})})})})]})});R.displayName="Menu";const G=_(({children:l,placement:o="bottom-start",...r},t)=>n(R,{placement:o,...r,nested:!1,ref:t,children:l}));G.displayName="Dropdown";const S=_(({className:l,...o},r)=>n("div",{...o,className:s("divider",l),ref:r}));S.displayName="MenuDivider";const Z=_(({className:l,header:o,children:r,...t},m)=>x("div",{className:s("dropdown__group",l),...t,ref:m,children:[o?n("div",{className:"dropdown__group-header",children:o}):null,r]}));Z.displayName="MenuGroup";export{G as Dropdown,R as Menu,S as MenuDivider,M as MenuElement,Z as MenuGroup};
//# sourceMappingURL=index.js.map
