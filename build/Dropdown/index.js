import{jsx as t,jsxs as N,Fragment as W}from"react/jsx-runtime";import{forwardRef as h,isValidElement as g,useState as E,useEffect as C,useRef as F,Children as j,cloneElement as X}from"react";import{useFloatingTree as se,useFloatingNodeId as de,useFloatingParentNodeId as pe,useFloating as ce,offset as ue,flip as me,shift as fe,size as we,autoUpdate as _e,useInteractions as he,useHover as ge,safePolygon as ve,useClick as ye,useRole as Ne,useDismiss as xe,useListNavigation as De,useTypeahead as ke,useMergeRefs as be,FloatingNode as Ee,FloatingOverlay as Ce,FloatingFocusManager as Fe}from"@floating-ui/react";import d from"classnames";import{Transition as Ie}from"react-transition-group";import{useFloatingContext as Me,FloatingTreeWrapper as Re}from"../FloatingProvider/index.js";import{useCustomDismiss as Pe}from"../hooks/useCustomDismiss.js";var p={submenu:"Dropdown-module_submenu__uXrqH",dropdown:"Dropdown-module_dropdown__QOREt",active:"Dropdown-module_active__p0UcD",appear:"Dropdown-module_appear__7ZQqu",dropdown_appear:"Dropdown-module_dropdown_appear__FJDEz",disappear:"Dropdown-module_disappear__9T3XQ",dropdown_disappear:"Dropdown-module_dropdown_disappear__3is4U",menu_root:"Dropdown-module_menu_root__in1ol",with_chevron:"Dropdown-module_with_chevron__ngan7"};const I=h(({selected:i,className:r,icon:a,children:l,submenu:m,...w},v)=>t("a",{ref:v,...w,className:d(r,{selected:i&&!m,[p.submenu]:m}),children:a?g(a)?N(W,{children:[a,g(l)?l:t("span",{className:"qtr-margin-left",children:l})]}):N(W,{children:[t("span",{className:a}),t("span",{className:"qtr-margin-left",children:l})]}):l}));I.displayName="MenuElement";const M=h(({children:i,label:r,noChevron:a,placement:l,strategy:m,alwaysClose:w,onOpen:v,onClose:R,isOpen:_,nested:n,withSizeLimit:S,portalId:Z,portalRoot:$,icon:V,...P},Y)=>{const[u,f]=E(_??!1),[T,x]=E(null),[D,O]=E(!1);C(()=>{typeof _<"u"&&f(_)},[_]);const A=F([]),ee=F(j.map(i,e=>g(e)?e.props.label:null)),s=se(),L=de(),k=pe();n!=null||(n=k!=null);const{root:oe,id:ne}=Me({root:$,portalId:Z,fallbackPortalId:"--cui-dropdown-portal"}),{x:z,y:K,reference:re,floating:te,strategy:ae,refs:U,context:c}=ce({open:u,onOpenChange:e=>{typeof v=="function"&&e&&v(),typeof R=="function"&&!e&&R(),f(e)},middleware:[ue({mainAxis:n?0:2,alignmentAxis:n?-5:0}),me(),fe(),S?we({apply({availableHeight:e,availableWidth:o,elements:y}){Object.assign(y.floating.style,{maxWidth:`${o}px`,maxHeight:`${e-4}px`})}}):void 0].filter(Boolean),placement:n?"right-start":l,nodeId:L,whileElementsMounted:_e,strategy:m}),{getReferenceProps:q,getFloatingProps:le,getItemProps:ie}=he([ge(c,{handleClose:ve({restMs:25}),enabled:n&&D,delay:{open:75}}),ye(c,{toggle:!n,event:"mousedown",ignoreMouse:n}),Ne(c,{role:"menu"}),xe(c,{bubbles:!0,outsidePress:!0,escapeKey:!1}),Pe(c),De(c,{listRef:A,activeIndex:T,nested:n,onNavigate:x}),ke(c,{listRef:ee,onMatch:u?x:void 0,activeIndex:T})]);C(()=>{function e(){var o;w&&f(!1),k===null&&((o=U.domReference.current)==null||o.focus())}return s?.events.on("click",e),()=>{s?.events.off("click",e)}},[k,s,U,w]),C(()=>{function e(){O(!0)}function o(){O(!1)}return window.addEventListener("pointermove",e,{once:!0,capture:!0}),window.addEventListener("keydown",o,!0),()=>{window.removeEventListener("pointermove",e,{capture:!0}),window.removeEventListener("keydown",o,!0)}},[D]);const H=F(null),Q=be([Y,re]);return N(Ee,{id:L,children:[g(r)?X(r,{...q({...P,ref:Q,onClick(e){e.stopPropagation(),e.currentTarget.focus()},...n?{className:d("menu_item",r.props.className,{open:u}),role:"menuitem",onKeyDown(e){(e.key==="ArrowUp"||e.key==="ArrowDown")&&f(!1)}}:{className:d(p.menu_root,r.props.className,{open:u,[p.with_chevron]:!a})}})}):t(I,{submenu:n,icon:V,...q({...P,ref:Q,onClick(e){e.stopPropagation(),e.currentTarget.focus()},...n?{className:d("menu_item",{open:u}),role:"menuitem",onKeyDown(e){(e.key==="ArrowUp"||e.key==="ArrowDown")&&f(!1)}}:{className:d(p.menu_root,{open:u,[p.with_chevron]:!a})}}),children:r}),t(Re,{withPortal:!s,portalId:ne,portalRoot:oe,children:t(Ie,{in:u,mountOnEnter:!0,unmountOnExit:!0,appear:!0,timeout:{enter:100,exit:250},nodeRef:H,children:e=>t(Ce,{style:{zIndex:n?50:"calc(var(--cui-max-zindex, 1000) + 2)"},children:t(Fe,{context:c,modal:!n,returnFocus:!n,order:["reference","content"],children:t("div",{...le({className:d("dropdown",p.dropdown,{[p.disappear]:e==="exiting"||e==="exited",[p.appear]:e==="entering",[p.active]:e==="entered"}),ref(o){H.current=o,te(o)},style:{position:ae,top:K??0,left:z??0},onKeyDown(o){o.key==="Tab"&&f(!1)}}),children:t("div",{className:"dropdown__menu",onClick:w?()=>{s?.events.emit("click")}:void 0,children:j.map(i,(o,y)=>g(o)&&X(o,ie({tabIndex:-1,role:"menuitem",className:d("menu_item",o.props.className),ref(b){A.current[y]=b},onClick(b){o.props.onClick?o.props.onClick(b):s?.events.emit("click")},onPointerEnter(){D&&x(y)}})))})})})})})})]})});M.displayName="Menu";const B=h(({children:i,placement:r="bottom-start",...a},l)=>t(M,{placement:r,...a,nested:!1,ref:l,children:i}));B.displayName="Dropdown";const G=h(({className:i,...r},a)=>t("div",{...r,className:d("divider",i),ref:a}));G.displayName="MenuDivider";const J=h(({className:i,header:r,children:a,...l},m)=>N("div",{className:d("dropdown__group",i),...l,ref:m,children:[r?t("div",{className:"dropdown__group-header",children:r}):null,a]}));J.displayName="MenuGroup";export{B as Dropdown,M as Menu,G as MenuDivider,I as MenuElement,J as MenuGroup};
//# sourceMappingURL=index.js.map
