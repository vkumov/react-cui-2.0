import{jsx as n,jsxs as x,Fragment as D}from"react/jsx-runtime";import{forwardRef as _,isValidElement as h,useState as F,useEffect as k,useRef as I,Children as Q,cloneElement as S}from"react";import{useFloatingTree as X,useFloatingNodeId as me,useFloatingParentNodeId as fe,useFloating as we,offset as _e,flip as he,shift as ve,size as ge,autoUpdate as ye,useInteractions as Ne,useHover as xe,safePolygon as De,useClick as ke,useRole as be,useDismiss as Ee,useListNavigation as Ce,useTypeahead as Fe,useMergeRefs as B,FloatingNode as Ie,FloatingOverlay as Pe,FloatingFocusManager as Re}from"@floating-ui/react";import s from"classnames";import{Transition as Me}from"react-transition-group";import Le from"react-use-event-hook";import{useFloatingContext as Oe,FloatingTreeWrapper as Te}from"../FloatingProvider/index.js";import{useCustomDismiss as Ae}from"../hooks/useCustomDismiss.js";var d={submenu:"Dropdown-module_submenu__uXrqH",dropdown:"Dropdown-module_dropdown__QOREt",active:"Dropdown-module_active__p0UcD",appear:"Dropdown-module_appear__7ZQqu",dropdown_appear:"Dropdown-module_dropdown_appear__FJDEz",disappear:"Dropdown-module_disappear__9T3XQ",dropdown_disappear:"Dropdown-module_dropdown_disappear__3is4U",menu_root:"Dropdown-module_menu_root__in1ol",with_chevron:"Dropdown-module_with_chevron__ngan7"};const P=_(({selected:l,className:o,icon:r,children:t,submenu:u,...v},g)=>n("a",{ref:g,...v,className:s(o,{selected:l&&!u,[d.submenu]:u}),children:r?h(r)?x(D,{children:[r,h(t)?t:n("span",{className:"qtr-margin-left",children:t})]}):x(D,{children:[n("span",{className:r}),n("span",{className:"qtr-margin-left",children:t})]}):t}));P.displayName="MenuElement";const ze=({onClick:l,children:o})=>{const r=X();return k(()=>{const t=r;return t?.events.on("click",l),()=>{t?.events.off("click",l)}},[r,l]),n(D,{children:o})},R=_(({children:l,label:o,noChevron:r,placement:t,strategy:u,alwaysClose:v,onOpen:g,onClose:M,isOpen:w,nested:i,withSizeLimit:J,portalId:V,portalRoot:Y,icon:ee,explicitPortal:L,...O},ne)=>{const[p,m]=F(w??!1),[T,b]=F(null),[E,A]=F(!1);k(()=>{typeof w<"u"&&m(w)},[w]);const z=I([]),oe=I(Q.map(l,e=>h(e)?e.props.label:null)),f=X(),H=me(),q=fe();i!=null||(i=q!=null);const{root:re,id:te}=Oe({root:Y,portalId:V,fallbackPortalId:"--cui-dropdown-portal"}),{x:K,y:U,reference:ie,floating:le,strategy:ae,refs:se,context:c}=we({open:p,onOpenChange:e=>{typeof g=="function"&&e&&g(),typeof M=="function"&&!e&&M(),m(e)},middleware:[_e({mainAxis:i?0:2,alignmentAxis:i?-5:0}),he(),ve(),J?ge({apply({availableHeight:e,availableWidth:a,elements:N}){Object.assign(N.floating.style,{maxWidth:`${a}px`,maxHeight:`${e-4}px`})}}):void 0].filter(Boolean),placement:i?"right-start":t,nodeId:H,whileElementsMounted:ye,strategy:u}),{getReferenceProps:W,getFloatingProps:de,getItemProps:ce}=Ne([xe(c,{handleClose:De({requireIntent:!0}),enabled:i&&E,delay:{open:75}}),ke(c,{toggle:!i,event:"mousedown",ignoreMouse:i}),be(c,{role:"menu"}),Ee(c,{bubbles:!0,outsidePress:!0,escapeKey:!1}),Ae(c),Ce(c,{listRef:z,activeIndex:T,nested:i,onNavigate:b}),Fe(c,{listRef:oe,onMatch:p?b:void 0,activeIndex:T})]),C=Le(()=>{var e;v&&m(!1),q===null&&((e=se.domReference.current)==null||e.focus())});k(()=>{function e(){A(!0)}function a(){A(!1)}return window.addEventListener("pointermove",e,{once:!0,capture:!0}),window.addEventListener("keydown",a,!0),()=>{window.removeEventListener("pointermove",e,{capture:!0}),window.removeEventListener("keydown",a,!0)}},[E]);const y=I(null),pe=B([y,le]),j=B([ne,ie]);return k(()=>{const e=a=>{y.current&&y.current.contains(a.target)&&(f?f.events.emit("click"):C())};return document.addEventListener("click",e),()=>{document.removeEventListener("click",e)}},[f,C]),x(D,{children:[h(o)?S(o,{...W({...O,ref:j,onClick(e){e.stopPropagation(),e.currentTarget.focus()},...i?{className:s("menu_item",o.props.className,{open:p}),role:"menuitem",onKeyDown(e){(e.key==="ArrowUp"||e.key==="ArrowDown")&&m(!1)}}:{className:s(d.menu_root,o.props.className,{open:p,[d.with_chevron]:!r})}})}):n(P,{submenu:i,icon:ee,...W({...O,ref:j,onClick(e){e.stopPropagation(),e.currentTarget.focus()},...i?{className:s("menu_item",{open:p}),role:"menuitem",onKeyDown(e){(e.key==="ArrowUp"||e.key==="ArrowDown")&&m(!1)}}:{className:s(d.menu_root,{open:p,[d.with_chevron]:!r})}}),children:o}),n(Me,{in:p,mountOnEnter:!0,unmountOnExit:!0,appear:!0,timeout:{enter:100,exit:250},nodeRef:y,children:e=>n(Te,{withPortal:L||!f,force:L?!0:void 0,portalId:te,portalRoot:re,children:n(Ie,{id:H,children:n(ze,{onClick:C,children:n(Pe,{style:{zIndex:i?50:"calc(var(--cui-max-zindex, 1000) + 2)"},children:n(Re,{context:c,modal:!i,returnFocus:!i,order:["reference","content"],children:n("div",{...de({className:s("dropdown",d.dropdown,{[d.disappear]:e==="exiting"||e==="exited",[d.appear]:e==="entering",[d.active]:e==="entered"}),ref:pe,style:{position:ae,top:U??0,left:K??0},onKeyDown(a){a.key==="Tab"&&m(!1)}}),children:n("div",{className:"dropdown__menu",onClick:v?()=>{f?.events.emit("click")}:void 0,children:Q.map(l,(a,N)=>h(a)&&S(a,ce({...a.props,tabIndex:-1,role:"menuitem",className:s("menu_item",a.props.className),ref(ue){z.current[N]=ue},onPointerEnter(){E&&b(N)}})))})})})})})})})})]})});R.displayName="Menu";const G=_(({children:l,placement:o="bottom-start",...r},t)=>n(R,{placement:o,...r,nested:!1,ref:t,children:l}));G.displayName="Dropdown";const Z=_(({className:l,...o},r)=>n("div",{...o,className:s("divider",l),ref:r}));Z.displayName="MenuDivider";const $=_(({className:l,header:o,children:r,...t},u)=>x("div",{className:s("dropdown__group",l),...t,ref:u,children:[o?n("div",{className:"dropdown__group-header",children:o}):null,r]}));$.displayName="MenuGroup";export{G as Dropdown,R as Menu,Z as MenuDivider,P as MenuElement,$ as MenuGroup};
//# sourceMappingURL=index.js.map
