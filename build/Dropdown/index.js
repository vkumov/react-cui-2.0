import{jsx as t,jsxs as N,Fragment as Q}from"react/jsx-runtime";import{forwardRef as h,isValidElement as g,useState as E,useEffect as C,useRef as F,Children as W,cloneElement as X}from"react";import{useFloatingTree as le,useFloatingNodeId as se,useFloatingParentNodeId as de,useFloating as pe,offset as ce,flip as ue,shift as me,size as fe,autoUpdate as we,useInteractions as _e,useHover as he,safePolygon as ge,useClick as ve,useRole as ye,useDismiss as Ne,useListNavigation as xe,useTypeahead as De,useMergeRefs as ke,FloatingNode as be,FloatingOverlay as Ee,FloatingFocusManager as Ce}from"@floating-ui/react";import d from"classnames";import{Transition as Fe}from"react-transition-group";import{useFloatingContext as Ie,FloatingTreeWrapper as Me}from"../FloatingProvider/index.js";import{useCustomDismiss as Re}from"../hooks/useCustomDismiss.js";var p={submenu:"Dropdown-module_submenu__uXrqH",dropdown:"Dropdown-module_dropdown__QOREt",active:"Dropdown-module_active__p0UcD",appear:"Dropdown-module_appear__7ZQqu",dropdown_appear:"Dropdown-module_dropdown_appear__FJDEz",disappear:"Dropdown-module_disappear__9T3XQ",dropdown_disappear:"Dropdown-module_dropdown_disappear__3is4U",menu_root:"Dropdown-module_menu_root__in1ol",with_chevron:"Dropdown-module_with_chevron__ngan7"};const I=h(({selected:l,className:r,icon:a,children:i,submenu:m,...w},v)=>t("a",{ref:v,...w,className:d(r,{selected:l&&!m,[p.submenu]:m}),children:a?g(a)?N(Q,{children:[a,g(i)?i:t("span",{className:"qtr-margin-left",children:i})]}):N(Q,{children:[t("span",{className:a}),t("span",{className:"qtr-margin-left",children:i})]}):i}));I.displayName="MenuElement";const M=h(({children:l,label:r,noChevron:a,placement:i,strategy:m,alwaysClose:w,onOpen:v,onClose:R,isOpen:_,nested:n,withSizeLimit:S,portalId:Z,portalRoot:$,...P},V)=>{const[u,f]=E(_??!1),[T,x]=E(null),[D,O]=E(!1);C(()=>{typeof _<"u"&&f(_)},[_]);const A=F([]),Y=F(W.map(l,e=>g(e)?e.props.label:null)),s=le(),L=se(),k=de();n!=null||(n=k!=null);const{root:ee,id:oe}=Ie({root:$,portalId:Z,fallbackPortalId:"--cui-dropdown-portal"}),{x:z,y:K,reference:ne,floating:re,strategy:te,refs:U,context:c}=pe({open:u,onOpenChange:e=>{typeof v=="function"&&e&&v(),typeof R=="function"&&!e&&R(),f(e)},middleware:[ce({mainAxis:n?0:2,alignmentAxis:n?-5:0}),ue(),me(),S?fe({apply({availableHeight:e,availableWidth:o,elements:y}){Object.assign(y.floating.style,{maxWidth:`${o}px`,maxHeight:`${e-4}px`})}}):void 0].filter(Boolean),placement:n?"right-start":i,nodeId:L,whileElementsMounted:we,strategy:m}),{getReferenceProps:j,getFloatingProps:ae,getItemProps:ie}=_e([he(c,{handleClose:ge({restMs:25}),enabled:n&&D,delay:{open:75}}),ve(c,{toggle:!n,event:"mousedown",ignoreMouse:n}),ye(c,{role:"menu"}),Ne(c,{bubbles:!0,outsidePress:!0,escapeKey:!1}),Re(c),xe(c,{listRef:A,activeIndex:T,nested:n,onNavigate:x}),De(c,{listRef:Y,onMatch:u?x:void 0,activeIndex:T})]);C(()=>{function e(){var o;w&&f(!1),k===null&&((o=U.domReference.current)==null||o.focus())}return s?.events.on("click",e),()=>{s?.events.off("click",e)}},[k,s,U,w]),C(()=>{function e(){O(!0)}function o(){O(!1)}return window.addEventListener("pointermove",e,{once:!0,capture:!0}),window.addEventListener("keydown",o,!0),()=>{window.removeEventListener("pointermove",e,{capture:!0}),window.removeEventListener("keydown",o,!0)}},[D]);const q=F(null),H=ke([V,ne]);return N(be,{id:L,children:[g(r)?X(r,{...j({...P,ref:H,onClick(e){e.stopPropagation(),e.currentTarget.focus()},...n?{className:d("menu_item",r.props.className,{open:u}),role:"menuitem",onKeyDown(e){(e.key==="ArrowUp"||e.key==="ArrowDown")&&f(!1)}}:{className:d(p.menu_root,r.props.className,{open:u,[p.with_chevron]:!a})}})}):t(I,{submenu:n,...j({...P,ref:H,onClick(e){e.stopPropagation(),e.currentTarget.focus()},...n?{className:d("menu_item",{open:u}),role:"menuitem",onKeyDown(e){(e.key==="ArrowUp"||e.key==="ArrowDown")&&f(!1)}}:{className:d(p.menu_root,{open:u,[p.with_chevron]:!a})}}),children:r}),t(Me,{withPortal:!s,portalId:oe,portalRoot:ee,children:t(Fe,{in:u,mountOnEnter:!0,unmountOnExit:!0,appear:!0,timeout:{enter:100,exit:250},nodeRef:q,children:e=>t(Ee,{style:{zIndex:n?50:"calc(var(--cui-max-zindex, 1000) + 2)"},children:t(Ce,{context:c,modal:!n,returnFocus:!n,order:["reference","content"],children:t("div",{...ae({className:d("dropdown",p.dropdown,{[p.disappear]:e==="exiting"||e==="exited",[p.appear]:e==="entering",[p.active]:e==="entered"}),ref(o){q.current=o,re(o)},style:{position:te,top:K??0,left:z??0},onKeyDown(o){o.key==="Tab"&&f(!1)}}),children:t("div",{className:"dropdown__menu",onClick:w?()=>{s?.events.emit("click")}:void 0,children:W.map(l,(o,y)=>g(o)&&X(o,ie({tabIndex:-1,role:"menuitem",className:d("menu_item",o.props.className),ref(b){A.current[y]=b},onClick(b){o.props.onClick?o.props.onClick(b):s?.events.emit("click")},onPointerEnter(){D&&x(y)}})))})})})})})})]})});M.displayName="Menu";const B=h(({children:l,placement:r="bottom-start",...a},i)=>t(M,{placement:r,...a,nested:!1,ref:i,children:l}));B.displayName="Dropdown";const G=h(({className:l,...r},a)=>t("div",{...r,className:d("divider",l),ref:a}));G.displayName="MenuDivider";const J=h(({className:l,header:r,children:a,...i},m)=>N("div",{className:d("dropdown__group",l),...i,ref:m,children:[r?t("div",{className:"dropdown__group-header",children:r}):null,a]}));J.displayName="MenuGroup";export{B as Dropdown,M as Menu,G as MenuDivider,I as MenuElement,J as MenuGroup};
//# sourceMappingURL=index.js.map
